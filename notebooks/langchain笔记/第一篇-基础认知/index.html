<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='ç¬¬ä¸€ç¯‡ï¼šåŸºç¡€è®¤çŸ¥# ğŸ“‹ å‰ç½®å‡†å¤‡# ç¯å¢ƒé…ç½®# åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®Œæˆä»¥ä¸‹ç¯å¢ƒé…ç½®ï¼š
1. Python ç‰ˆæœ¬# python --version # éœ€è¦ Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬2. å®‰è£…ä¾èµ–# # ä½¿ç”¨ pip å®‰è£…æœ€æ–°ç‰ˆæœ¬ pip install langchain langchain-openai langgraph langchain-community # æˆ–ä½¿ç”¨ uv (æ¨è) uv pip install langchain langchain-openai langgraph langchain-community # å¦‚éœ€æŒ‡å®šç‰ˆæœ¬ï¼ˆæ¨èä½¿ç”¨1.0.7æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ pip install langchain>=1.0.7 langchain-openai>=1.0.3 langgraph>=1.0.33. ç¯å¢ƒå˜é‡é…ç½®# # åˆ›å»º .env æ–‡ä»¶ OPENAI_API_KEY=sk-your-api-key-here LANGSMITH_API_KEY=your-langsmith-key # å¯é€‰,ç”¨äºç›‘æ§ LANGSMITH_TRACING=true # å¯é€‰ # åœ¨ä»£ç ä¸­åŠ è½½ from dotenv import load_dotenv import os load_dotenv() # éªŒè¯ç¯å¢ƒå˜é‡ required_vars = ["OPENAI_API_KEY"] for var in required_vars: if not os.getenv(var): raise EnvironmentError(f"ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: {var}")4. ä¾èµ–ç‰ˆæœ¬æ¸…å•# # pyproject.toml æ¨èé…ç½® [tool.poetry.dependencies] python = "^3.10" langchain = "^1.0.7" langchain-openai = "^1.0.3" langgraph = "^1.0.3" langchain-community = "^0.3.0" langchain-core = "^1.0.7" langsmith = "^0.4.43" python-dotenv = "^1.0.0" # requirements.txt æ ¼å¼ # langchain>=1.0.7 # langchain-openai>=1.0.3 # langgraph>=1.0.3 # langchain-community>=0.3.0 # langchain-core>=1.0.7 # langsmith>=0.4.43 # python-dotenv>=1.0.0å‰ç½®çŸ¥è¯†# å»ºè®®å…·å¤‡ä»¥ä¸‹åŸºç¡€çŸ¥è¯†ï¼š
'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://LordFoxFairy.github.io/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%80%E7%AF%87-%E5%9F%BA%E7%A1%80%E8%AE%A4%E7%9F%A5/"><meta property="og:site_name" content="LordFoxFairyçš„ç¬”è®°æœ¬"><meta property="og:title" content="ç¬¬ä¸€ç¯‡ åŸºç¡€è®¤çŸ¥"><meta property="og:description" content='ç¬¬ä¸€ç¯‡ï¼šåŸºç¡€è®¤çŸ¥# ğŸ“‹ å‰ç½®å‡†å¤‡# ç¯å¢ƒé…ç½®# åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®Œæˆä»¥ä¸‹ç¯å¢ƒé…ç½®ï¼š
1. Python ç‰ˆæœ¬# python --version # éœ€è¦ Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬2. å®‰è£…ä¾èµ–# # ä½¿ç”¨ pip å®‰è£…æœ€æ–°ç‰ˆæœ¬ pip install langchain langchain-openai langgraph langchain-community # æˆ–ä½¿ç”¨ uv (æ¨è) uv pip install langchain langchain-openai langgraph langchain-community # å¦‚éœ€æŒ‡å®šç‰ˆæœ¬ï¼ˆæ¨èä½¿ç”¨1.0.7æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ pip install langchain>=1.0.7 langchain-openai>=1.0.3 langgraph>=1.0.33. ç¯å¢ƒå˜é‡é…ç½®# # åˆ›å»º .env æ–‡ä»¶ OPENAI_API_KEY=sk-your-api-key-here LANGSMITH_API_KEY=your-langsmith-key # å¯é€‰,ç”¨äºç›‘æ§ LANGSMITH_TRACING=true # å¯é€‰ # åœ¨ä»£ç ä¸­åŠ è½½ from dotenv import load_dotenv import os load_dotenv() # éªŒè¯ç¯å¢ƒå˜é‡ required_vars = ["OPENAI_API_KEY"] for var in required_vars: if not os.getenv(var): raise EnvironmentError(f"ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: {var}")4. ä¾èµ–ç‰ˆæœ¬æ¸…å•# # pyproject.toml æ¨èé…ç½® [tool.poetry.dependencies] python = "^3.10" langchain = "^1.0.7" langchain-openai = "^1.0.3" langgraph = "^1.0.3" langchain-community = "^0.3.0" langchain-core = "^1.0.7" langsmith = "^0.4.43" python-dotenv = "^1.0.0" # requirements.txt æ ¼å¼ # langchain>=1.0.7 # langchain-openai>=1.0.3 # langgraph>=1.0.3 # langchain-community>=0.3.0 # langchain-core>=1.0.7 # langsmith>=0.4.43 # python-dotenv>=1.0.0å‰ç½®çŸ¥è¯†# å»ºè®®å…·å¤‡ä»¥ä¸‹åŸºç¡€çŸ¥è¯†ï¼š'><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="notebooks"><meta itemprop=name content="ç¬¬ä¸€ç¯‡ åŸºç¡€è®¤çŸ¥"><meta itemprop=description content='ç¬¬ä¸€ç¯‡ï¼šåŸºç¡€è®¤çŸ¥# ğŸ“‹ å‰ç½®å‡†å¤‡# ç¯å¢ƒé…ç½®# åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®Œæˆä»¥ä¸‹ç¯å¢ƒé…ç½®ï¼š
1. Python ç‰ˆæœ¬# python --version # éœ€è¦ Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬2. å®‰è£…ä¾èµ–# # ä½¿ç”¨ pip å®‰è£…æœ€æ–°ç‰ˆæœ¬ pip install langchain langchain-openai langgraph langchain-community # æˆ–ä½¿ç”¨ uv (æ¨è) uv pip install langchain langchain-openai langgraph langchain-community # å¦‚éœ€æŒ‡å®šç‰ˆæœ¬ï¼ˆæ¨èä½¿ç”¨1.0.7æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ pip install langchain>=1.0.7 langchain-openai>=1.0.3 langgraph>=1.0.33. ç¯å¢ƒå˜é‡é…ç½®# # åˆ›å»º .env æ–‡ä»¶ OPENAI_API_KEY=sk-your-api-key-here LANGSMITH_API_KEY=your-langsmith-key # å¯é€‰,ç”¨äºç›‘æ§ LANGSMITH_TRACING=true # å¯é€‰ # åœ¨ä»£ç ä¸­åŠ è½½ from dotenv import load_dotenv import os load_dotenv() # éªŒè¯ç¯å¢ƒå˜é‡ required_vars = ["OPENAI_API_KEY"] for var in required_vars: if not os.getenv(var): raise EnvironmentError(f"ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: {var}")4. ä¾èµ–ç‰ˆæœ¬æ¸…å•# # pyproject.toml æ¨èé…ç½® [tool.poetry.dependencies] python = "^3.10" langchain = "^1.0.7" langchain-openai = "^1.0.3" langgraph = "^1.0.3" langchain-community = "^0.3.0" langchain-core = "^1.0.7" langsmith = "^0.4.43" python-dotenv = "^1.0.0" # requirements.txt æ ¼å¼ # langchain>=1.0.7 # langchain-openai>=1.0.3 # langgraph>=1.0.3 # langchain-community>=0.3.0 # langchain-core>=1.0.7 # langsmith>=0.4.43 # python-dotenv>=1.0.0å‰ç½®çŸ¥è¯†# å»ºè®®å…·å¤‡ä»¥ä¸‹åŸºç¡€çŸ¥è¯†ï¼š'><meta itemprop=wordCount content="2600"><title>ç¬¬ä¸€ç¯‡ åŸºç¡€è®¤çŸ¥ | LordFoxFairyçš„ç¬”è®°æœ¬</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://LordFoxFairy.github.io/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%80%E7%AF%87-%E5%9F%BA%E7%A1%80%E8%AE%A4%E7%9F%A5/><link rel=stylesheet href=/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG+T2l66Bw7pV8=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.a7a11a812549b6c20d4eeaf4a5a8317847527505f7a0ad3e6824fb320b3128a8.js integrity="sha256-p6EagSVJtsINTur0pagxeEdSdQX3oK0+aCT7MgsxKKg=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-notebooks"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>LordFoxFairyçš„ç¬”è®°æœ¬</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-8410cdd8ef137d6cb143c08e6db6ba10 class=toggle checked>
<label for=section-8410cdd8ef137d6cb143c08e6db6ba10 class=flex><a role=button>LangChainç¬”è®°</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%80%E7%AF%87-%E5%9F%BA%E7%A1%80%E8%AE%A4%E7%9F%A5/ class=active>ç¬¬ä¸€ç¯‡ åŸºç¡€è®¤çŸ¥</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%8C%E7%AF%87-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E5%AE%9E%E6%88%98/>ç¬¬äºŒç¯‡ å¿«é€Ÿä¸Šæ‰‹å®æˆ˜</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%89%E7%AF%87-langgraph-%E6%B7%B1%E5%85%A5/>ç¬¬ä¸‰ç¯‡ LangGraph æ·±å…¥</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%9B%9B%E7%AF%87-rag%E5%9F%BA%E7%A1%80%E7%AF%87langchain%E7%AF%87/>ç¬¬å››ç¯‡ RAGåŸºç¡€ç¯‡(LangChainç¯‡)</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%9B%9B%E7%AF%87-rag%E5%9F%BA%E7%A1%80%E7%AF%87llamaindex%E7%AF%87/>ç¬¬å››ç¯‡ RAGåŸºç¡€ç¯‡(LlamaIndexç¯‡)</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%94%E7%AF%87-rag%E9%AB%98%E7%BA%A7%E7%AF%87langchain%E7%AF%87/>ç¬¬äº”ç¯‡ RAGé«˜çº§ç¯‡(LangChainç¯‡)</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%94%E7%AF%87-rag%E9%AB%98%E7%BA%A7%E7%AF%87llamaindex%E7%AF%87/>ç¬¬äº”ç¯‡ RAGé«˜çº§ç¯‡(LlamaIndexç¯‡)</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%85%AD%E7%AF%87-%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/>ç¬¬å…­ç¯‡ æ–‡æ¡£å¤„ç†ä¸æ•°æ®æ¸…æ´—</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%83%E7%AF%87-deep-agents/>ç¬¬ä¸ƒç¯‡ Deep Agents</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%85%AB%E7%AF%87-middleware-%E5%B7%A5%E7%A8%8B%E5%8C%96/>ç¬¬å…«ç¯‡ Middleware å·¥ç¨‹åŒ–</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B9%9D%E7%AF%87-agent-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/>ç¬¬ä¹ç¯‡ Agent æ¶æ„è®¾è®¡</a></li><li><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%8D%81%E7%AF%87-%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E4%B8%8E%E7%9B%91%E6%8E%A7%E8%AF%84%E4%BC%B0/>ç¬¬åç¯‡ ç”Ÿäº§å®è·µä¸ç›‘æ§è¯„ä¼°</a></li><li><input type=checkbox id=section-a3e9b1811e5a21dbfddb0753f565cedb class=toggle>
<label for=section-a3e9b1811e5a21dbfddb0753f565cedb class=flex><a role=button>assets</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul></ul></li><li><input type=checkbox id=section-9a64553a000534ad3c81a611c6c29ec2 class=toggle>
<label for=section-9a64553a000534ad3c81a611c6c29ec2 class=flex><a role=button>code</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><input type=checkbox id=section-6fad2589acfdd5d6a1fb55beb392fb77 class=toggle>
<label for=section-6fad2589acfdd5d6a1fb55beb392fb77 class=flex><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/code/fasta2a/>fasta2a</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul></ul></li></ul></li></ul></li><li><input type=checkbox id=section-ce33306d44f9ed4d296b9a79329bed1c class=toggle>
<label for=section-ce33306d44f9ed4d296b9a79329bed1c class=flex><a role=button>å›¾åƒç®—æ³•ç¬”è®°</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%80%E7%AF%87_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/>ç¬¬ä¸€ç¯‡ æœºå™¨å­¦ä¹ åŸºç¡€</a></li><li><a href=/notebooks/%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%8C%E7%AF%87_%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/>ç¬¬äºŒç¯‡ æ·±åº¦å­¦ä¹ åŸºç¡€</a></li><li><a href=/notebooks/%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%89%E7%AF%87_%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/>ç¬¬ä¸‰ç¯‡ è®¡ç®—æœºè§†è§‰æ ¸å¿ƒæŠ€æœ¯</a></li><li><a href=/notebooks/%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%9B%9B%E7%AF%87_%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E4%B8%8Eyolo%E7%B3%BB%E5%88%97/>ç¬¬å››ç¯‡ ç›®æ ‡æ£€æµ‹ä¸YOLOç³»åˆ—</a></li><li><a href=/notebooks/%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%94%E7%AF%87_%E5%9B%BE%E5%83%8F%E5%88%86%E5%89%B2/>ç¬¬äº”ç¯‡ å›¾åƒåˆ†å‰²</a></li><li><a href=/notebooks/%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%85%AD%E7%AF%87_%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B/>ç¬¬å…­ç¯‡ ç”Ÿæˆæ¨¡å‹</a></li><li><a href=/notebooks/%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%83%E7%AF%87_%E8%A7%86%E8%A7%89%E5%A4%A7%E6%A8%A1%E5%9E%8B/>ç¬¬ä¸ƒç¯‡ è§†è§‰å¤§æ¨¡å‹</a></li><li><a href=/notebooks/%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%85%AB%E7%AF%87_%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5/>ç¬¬å…«ç¯‡ ç”Ÿäº§å®è·µ</a></li></ul></li><li><input type=checkbox id=section-77f5db9e44a9af6dab4403b49a65334f class=toggle>
<label for=section-77f5db9e44a9af6dab4403b49a65334f class=flex><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/>å¤§æ¨¡å‹ç¬”è®°</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><input type=checkbox id=section-db59738de306cbbe384ad7fbd5cf11b5 class=toggle>
<label for=section-db59738de306cbbe384ad7fbd5cf11b5 class=flex><a role=button>ç¬¬ä¸€éƒ¨åˆ†ï¼šå¤§è¯­è¨€æ¨¡å‹åŸºç¡€</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%9F%BA%E7%A1%80/%E7%AC%AC1%E7%AB%A0_%E5%88%9D%E8%AF%86%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/>ç¬¬1ç«  åˆè¯†å¤§è¯­è¨€æ¨¡å‹</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%9F%BA%E7%A1%80/%E7%AC%AC2%E7%AB%A0_%E4%B8%8E%E6%A8%A1%E5%9E%8B%E5%AF%B9%E8%AF%9D%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B%E5%9F%BA%E7%A1%80/>ç¬¬2ç«  ä¸æ¨¡å‹å¯¹è¯ï¼šæç¤ºå·¥ç¨‹åŸºç¡€</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%9F%BA%E7%A1%80/%E7%AC%AC3%E7%AB%A0_%E8%AF%AD%E8%A8%80%E7%9A%84%E5%9F%BA%E7%9F%B3%E5%88%86%E8%AF%8D%E4%B8%8E%E5%B5%8C%E5%85%A5/>ç¬¬3ç«  è¯­è¨€çš„åŸºçŸ³ï¼šåˆ†è¯ä¸åµŒå…¥</a></li></ul></li><li><input type=checkbox id=section-30b17899e420f6a53aa6e578440dd132 class=toggle>
<label for=section-30b17899e420f6a53aa6e578440dd132 class=flex><a role=button>ç¬¬äºŒéƒ¨åˆ†ï¼šTransformeræ¶æ„æ­ç§˜</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86transformer%E6%9E%B6%E6%9E%84%E6%8F%AD%E7%A7%98/%E7%AC%AC1%E7%AB%A0_transformer%E6%A0%B8%E5%BF%83%E6%8F%AD%E7%A7%98/>ç¬¬1ç«  Transformeræ ¸å¿ƒæ­ç§˜</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86transformer%E6%9E%B6%E6%9E%84%E6%8F%AD%E7%A7%98/%E7%AC%AC2%E7%AB%A0_%E6%A8%A1%E5%9E%8B%E5%AE%B6%E6%97%8F%E8%B0%B1%E7%B3%BB%E4%BB%8E%E7%BC%96%E7%A0%81%E5%99%A8%E5%88%B0%E8%A7%A3%E7%A0%81%E5%99%A8/>ç¬¬2ç«  æ¨¡å‹å®¶æ—è°±ç³»ï¼šä»ç¼–ç å™¨åˆ°è§£ç å™¨</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86transformer%E6%9E%B6%E6%9E%84%E6%8F%AD%E7%A7%98/%E7%AC%AC3%E7%AB%A0_%E9%A2%84%E8%AE%AD%E7%BB%83%E7%9A%84%E5%A5%A5%E7%A7%98%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%88%B0%E6%99%BA%E8%83%BD/>ç¬¬3ç«  é¢„è®­ç»ƒçš„å¥¥ç§˜ï¼šä»æ•°æ®åˆ°æ™ºèƒ½</a></li></ul></li><li><input type=checkbox id=section-da88ac5e3d01ea6f4b2996cb87ecf19f class=toggle>
<label for=section-da88ac5e3d01ea6f4b2996cb87ecf19f class=flex><a role=button>ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ•°æ®å·¥ç¨‹ä¸å®šåˆ¶åŒ–</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8B%E4%B8%8E%E5%AE%9A%E5%88%B6%E5%8C%96/%E7%AC%AC1%E7%AB%A0_%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8B%E5%9F%BA%E7%A1%80/>ç¬¬1ç«  æ•°æ®å·¥ç¨‹åŸºç¡€</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8B%E4%B8%8E%E5%AE%9A%E5%88%B6%E5%8C%96/%E7%AC%AC2%E7%AB%A0_%E5%BE%AE%E8%B0%83%E4%BD%A0%E7%9A%84%E4%B8%93%E5%B1%9E%E6%A8%A1%E5%9E%8B/>ç¬¬2ç«  å¾®è°ƒä½ çš„ä¸“å±æ¨¡å‹</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8B%E4%B8%8E%E5%AE%9A%E5%88%B6%E5%8C%96/%E7%AC%AC3%E7%AB%A0_%E4%B8%8E%E4%BA%BA%E7%B1%BB%E5%AF%B9%E9%BD%90%E5%81%8F%E5%A5%BD%E4%BC%98%E5%8C%96/>ç¬¬3ç«  ä¸äººç±»å¯¹é½ï¼šåå¥½ä¼˜åŒ–</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8B%E4%B8%8E%E5%AE%9A%E5%88%B6%E5%8C%96/%E7%AC%AC4%E7%AB%A0_%E5%88%9B%E5%BB%BA%E6%9B%B4%E4%BC%98%E7%9A%84%E5%B5%8C%E5%85%A5%E6%A8%A1%E5%9E%8B/>ç¬¬4ç«  åˆ›å»ºæ›´ä¼˜çš„åµŒå…¥æ¨¡å‹</a></li></ul></li><li><input type=checkbox id=section-81f0a7a10bc544ea0e1fd883e2a436eb class=toggle>
<label for=section-81f0a7a10bc544ea0e1fd883e2a436eb class=flex><a role=button>ç¬¬å››éƒ¨åˆ†ï¼šå¤§æ¨¡å‹åº”ç”¨å¼€å‘</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/%E7%AC%AC1%E7%AB%A0_%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B%E4%B8%8E%E4%B8%8A%E4%B8%8B%E6%96%87%E5%AD%A6%E4%B9%A0/>ç¬¬1ç«  æç¤ºå·¥ç¨‹ä¸ä¸Šä¸‹æ–‡å­¦ä¹ </a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/%E7%AC%AC2%E7%AB%A0_%E6%A3%80%E7%B4%A2%E5%A2%9E%E5%BC%BA%E7%94%9F%E6%88%90rag%E5%8E%9F%E7%90%86/>ç¬¬2ç«  æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åŸç†</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/%E7%AC%AC3%E7%AB%A0_%E6%99%BA%E8%83%BD%E4%BD%93agent%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6/>ç¬¬3ç«  æ™ºèƒ½ä½“ï¼ˆAgentï¼‰æ ¸å¿ƒæœºåˆ¶</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/%E7%AC%AC4%E7%AB%A0_%E5%A4%9A%E6%A8%A1%E6%80%81%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8E%9F%E7%90%86/>ç¬¬4ç«  å¤šæ¨¡æ€å¤§æ¨¡å‹åŸç†</a></li></ul></li><li><input type=checkbox id=section-0509decfe880d3d2074947902aea8022 class=toggle>
<label for=section-0509decfe880d3d2074947902aea8022 class=flex><a role=button>ç¬¬äº”éƒ¨åˆ†ï¼šå·¥ç¨‹å®æˆ˜å·¥å…·æ ˆ</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%E5%B7%A5%E7%A8%8B%E5%AE%9E%E6%88%98%E5%B7%A5%E5%85%B7%E6%A0%88/%E7%AC%AC1%E7%AB%A0_hugging_face%E7%94%9F%E6%80%81%E5%85%A8%E6%99%AF/>ç¬¬1ç«  Hugging Faceç”Ÿæ€å…¨æ™¯</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%E5%B7%A5%E7%A8%8B%E5%AE%9E%E6%88%98%E5%B7%A5%E5%85%B7%E6%A0%88/%E7%AC%AC2%E7%AB%A0_llama-factory%E5%BE%AE%E8%B0%83%E5%B7%A5%E5%8E%82/>ç¬¬2ç«  LLaMA-Factoryå¾®è°ƒå·¥å‚</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%E5%B7%A5%E7%A8%8B%E5%AE%9E%E6%88%98%E5%B7%A5%E5%85%B7%E6%A0%88/%E7%AC%AC3%E7%AB%A0_trl%E4%B8%8E%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98/>ç¬¬3ç«  TRLä¸å¼ºåŒ–å­¦ä¹ å®æˆ˜</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%E5%B7%A5%E7%A8%8B%E5%AE%9E%E6%88%98%E5%B7%A5%E5%85%B7%E6%A0%88/%E7%AC%AC4%E7%AB%A0_deepspeed%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83/>ç¬¬4ç«  DeepSpeedåˆ†å¸ƒå¼è®­ç»ƒ</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%E5%B7%A5%E7%A8%8B%E5%AE%9E%E6%88%98%E5%B7%A5%E5%85%B7%E6%A0%88/%E7%AC%AC5%E7%AB%A0_%E7%AB%AF%E5%88%B0%E7%AB%AFllm%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/>ç¬¬5ç«  ç«¯åˆ°ç«¯LLMé¡¹ç›®å®æˆ˜</a></li></ul></li><li><input type=checkbox id=section-dc465ed94a0f7fb78440cab8a8a2a28b class=toggle>
<label for=section-dc465ed94a0f7fb78440cab8a8a2a28b class=flex><a role=button>ç¬¬å…­éƒ¨åˆ†ï¼šç”Ÿäº§éƒ¨ç½²ä¸è¯„ä¼°</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%85%AD%E9%83%A8%E5%88%86%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%AF%84%E4%BC%B0/%E7%AC%AC1%E7%AB%A0_%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9%E4%B8%8E%E6%8E%A8%E7%90%86%E5%8A%A0%E9%80%9F/>ç¬¬1ç«  æ¨¡å‹å‹ç¼©ä¸æ¨ç†åŠ é€Ÿ</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%85%AD%E9%83%A8%E5%88%86%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%AF%84%E4%BC%B0/%E7%AC%AC2%E7%AB%A0_vllm%E9%AB%98%E6%80%A7%E8%83%BD%E6%8E%A8%E7%90%86/>ç¬¬2ç«  vLLMé«˜æ€§èƒ½æ¨ç†</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E5%85%AD%E9%83%A8%E5%88%86%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%AF%84%E4%BC%B0/%E7%AC%AC3%E7%AB%A0_%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%E4%BD%93%E7%B3%BB/>ç¬¬3ç«  æ¨¡å‹è¯„ä¼°ä½“ç³»</a></li></ul></li><li><input type=checkbox id=section-54ec04ac2cdda7238de2ed38f0bcb7b1 class=toggle>
<label for=section-54ec04ac2cdda7238de2ed38f0bcb7b1 class=flex><a role=button>ç¬¬ä¸ƒéƒ¨åˆ†ï¼šé«˜çº§æŠ€æœ¯ä¸“é¢˜</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%83%E9%83%A8%E5%88%86%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E7%AC%AC1%E7%AB%A0_%E9%95%BF%E4%B8%8A%E4%B8%8B%E6%96%87%E6%8A%80%E6%9C%AF/>ç¬¬1ç«  é•¿ä¸Šä¸‹æ–‡æŠ€æœ¯</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%83%E9%83%A8%E5%88%86%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E7%AC%AC2%E7%AB%A0_%E6%96%B0%E5%9E%8B%E6%9E%B6%E6%9E%84%E6%8E%A2%E7%B4%A2/>ç¬¬2ç«  æ–°å‹æ¶æ„æ¢ç´¢</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%83%E9%83%A8%E5%88%86%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E7%AC%AC3%E7%AB%A0_%E6%8E%A8%E7%90%86%E5%8A%A0%E9%80%9F%E9%BB%91%E7%A7%91%E6%8A%80/>ç¬¬3ç«  æ¨ç†åŠ é€Ÿé»‘ç§‘æŠ€</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%83%E9%83%A8%E5%88%86%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E7%AC%AC4%E7%AB%A0_%E6%8E%A8%E7%90%86%E6%A8%A1%E5%9E%8B%E4%B8%93%E9%A2%98/>ç¬¬4ç«  æ¨ç†æ¨¡å‹ä¸“é¢˜</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%B8%83%E9%83%A8%E5%88%86%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E7%AC%AC5%E7%AB%A0_%E6%A8%A1%E5%9E%8B%E5%AE%89%E5%85%A8%E4%B8%8E%E5%8F%AF%E8%A7%A3%E9%87%8A%E6%80%A7/>ç¬¬5ç«  æ¨¡å‹å®‰å…¨ä¸å¯è§£é‡Šæ€§</a></li></ul></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/glossary/>GLOSSARY</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/roadmap/>ROADMAP</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/summary/>SUMMARY</a></li><li><a href=/notebooks/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/%E5%AE%8C%E7%BB%93%E6%8A%A5%E5%91%8A/>å®Œç»“æŠ¥å‘Š</a></li></ul></li><li><input type=checkbox id=section-7177254393287994b491879262a62a06 class=toggle>
<label for=section-7177254393287994b491879262a62a06 class=flex><a role=button>å®è·µç¬”è®°</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/2.-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-fastapi/>æ·±å…¥ç†è§£ FastAPI</a></li><li><a href=/notebooks/%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/4.-agent%E6%9C%80%E4%BD%B3%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>Agentæœ€ä½³è®¾è®¡æ¨¡å¼</a></li></ul></li><li><input type=checkbox id=section-0172eb8516eeb7b4e657f3949a135c25 class=toggle>
<label for=section-0172eb8516eeb7b4e657f3949a135c25 class=flex><a role=button>æœºå™¨å­¦ä¹ ç¬”è®°</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC01%E7%AB%A0_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A6%82%E8%A7%88/>ç¬¬01ç«  æœºå™¨å­¦ä¹ æ¦‚è§ˆ</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC02%E7%AB%A0_%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97%E4%B8%8E%E5%BE%AE%E7%A7%AF%E5%88%86/>ç¬¬02ç«  çŸ©é˜µè¿ç®—ä¸å¾®ç§¯åˆ†</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC03%E7%AB%A0_svd%E4%B8%8E%E7%9F%A9%E9%98%B5%E5%88%86%E8%A7%A3/>ç¬¬03ç«  SVDä¸çŸ©é˜µåˆ†è§£</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC04%E7%AB%A0_%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83_%E6%8C%87%E6%95%B0%E6%97%8F%E4%B8%8E%E5%85%B1%E8%BD%AD%E5%85%88%E9%AA%8C/>ç¬¬04ç«  æ¦‚ç‡åˆ†å¸ƒ æŒ‡æ•°æ—ä¸å…±è½­å…ˆéªŒ</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC05%E7%AB%A0_%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/>ç¬¬05ç«  çº¿æ€§å›å½’</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC06%E7%AB%A0_%E6%84%9F%E7%9F%A5%E6%9C%BA/>ç¬¬06ç«  æ„ŸçŸ¥æœº</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC07%E7%AB%A0_%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BAsvm/>ç¬¬07ç«  æ”¯æŒå‘é‡æœº(SVM)</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC08%E7%AB%A0_%E6%A0%B8%E6%96%B9%E6%B3%95/>ç¬¬08ç«  æ ¸æ–¹æ³•</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC09%E7%AB%A0_%E5%86%B3%E7%AD%96%E6%A0%91%E4%B8%8E%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/>ç¬¬09ç«  å†³ç­–æ ‘ä¸é›†æˆå­¦ä¹ </a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC10%E7%AB%A0_%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%E4%B8%8E%E6%9C%80%E5%A4%A7%E7%86%B5%E6%A8%A1%E5%9E%8B/>ç¬¬10ç«  é€»è¾‘å›å½’ä¸æœ€å¤§ç†µæ¨¡å‹</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC11%E7%AB%A0_%E5%B9%BF%E4%B9%89%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8Bglm/>ç¬¬11ç«  å¹¿ä¹‰çº¿æ€§æ¨¡å‹(GLM)</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC13%E7%AB%A0_%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B_%E8%A1%A8%E7%A4%BA/>ç¬¬13ç«  æ¦‚ç‡å›¾æ¨¡å‹ è¡¨ç¤º</a></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC14%E7%AB%A0_%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B_%E6%8E%A8%E6%96%AD/>ç¬¬14ç«  æ¦‚ç‡å›¾æ¨¡å‹ æ¨æ–­</a></li><li><input type=checkbox id=section-b17efd79c46843a887113a063f929150 class=toggle>
<label for=section-b17efd79c46843a887113a063f929150 class=flex><a role=button>assets</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul></ul></li><li><a href=/notebooks/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/skills/>skills</a></li></ul></li><li><input type=checkbox id=section-29762f225235d2ac19b613cc28b093c8 class=toggle>
<label for=section-29762f225235d2ac19b613cc28b093c8 class=flex><a href=/notebooks/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>æ·±åº¦å­¦ä¹ ç¬”è®°</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/notebooks/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%AC1%E7%AB%A0_%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/>ç¬¬1ç«  æ·±åº¦å­¦ä¹ åŸºç¡€</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/icons/menu.svg class=book-icon alt=Menu></label><h3>ç¬¬ä¸€ç¯‡ åŸºç¡€è®¤çŸ¥</h3><label for=toc-control><img src=/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#-å‰ç½®å‡†å¤‡>ğŸ“‹ å‰ç½®å‡†å¤‡</a><ul><li><a href=#ç¯å¢ƒé…ç½®>ç¯å¢ƒé…ç½®</a><ul><li><a href=#1-python-ç‰ˆæœ¬>1. Python ç‰ˆæœ¬</a></li><li><a href=#2-å®‰è£…ä¾èµ–>2. å®‰è£…ä¾èµ–</a></li><li><a href=#3-ç¯å¢ƒå˜é‡é…ç½®>3. ç¯å¢ƒå˜é‡é…ç½®</a></li><li><a href=#4-ä¾èµ–ç‰ˆæœ¬æ¸…å•>4. ä¾èµ–ç‰ˆæœ¬æ¸…å•</a></li></ul></li><li><a href=#å‰ç½®çŸ¥è¯†>å‰ç½®çŸ¥è¯†</a></li></ul></li><li><a href=#ç¬¬1ç« langchain-ç”Ÿæ€å…¨æ™¯>ç¬¬1ç« ï¼šLangChain ç”Ÿæ€å…¨æ™¯</a><ul><li><a href=#11-æ¶æ„å±‚æ¬¡å…³ç³»>1.1 æ¶æ„å±‚æ¬¡å…³ç³»</a><ul><li><a href=#111-langchain-ä¸-langgraph-çš„å…³ç³»>1.1.1 LangChain ä¸ LangGraph çš„å…³ç³»</a></li><li><a href=#112-å¦‚ä½•æ„å»º-agent>1.1.2 å¦‚ä½•æ„å»º Agent</a></li><li><a href=#113-lcel-çš„å®šä½ä¸ä½œç”¨>1.1.3 LCEL çš„å®šä½ä¸ä½œç”¨</a></li><li><a href=#114-langsmith-çš„ç›‘æ§èŒè´£>1.1.4 LangSmith çš„ç›‘æ§èŒè´£</a></li></ul></li><li><a href=#12-æ ¸å¿ƒè®¾è®¡ç†å¿µ>1.2 æ ¸å¿ƒè®¾è®¡ç†å¿µ</a><ul><li><a href=#121-provider-agnostic-è®¾è®¡>1.2.1 Provider-Agnostic è®¾è®¡</a></li><li><a href=#122-runnable-protocol-ç»Ÿä¸€æŠ½è±¡>1.2.2 Runnable Protocol ç»Ÿä¸€æŠ½è±¡</a></li><li><a href=#123-middleware-driven-æ¶æ„>1.2.3 Middleware-Driven æ¶æ„</a></li><li><a href=#124-production-first-ç†å¿µ>1.2.4 Production-First ç†å¿µ</a></li></ul></li><li><a href=#13-æŠ€æœ¯é€‰å‹å†³ç­–æ ‘>1.3 æŠ€æœ¯é€‰å‹å†³ç­–æ ‘</a></li><li><a href=#131-ä½•æ—¶ä½¿ç”¨-create_agent>1.3.1 ä½•æ—¶ä½¿ç”¨ create_agent</a></li><li><a href=#132-ä½•æ—¶æ·±å…¥-langgraph>1.3.2 ä½•æ—¶æ·±å…¥ LangGraph</a></li><li><a href=#133-ä½•æ—¶ä½¿ç”¨-deep-agents>1.3.3 ä½•æ—¶ä½¿ç”¨ Deep Agents</a></li><li><a href=#134-ä½•æ—¶éœ€è¦-middleware>1.3.4 ä½•æ—¶éœ€è¦ Middleware</a></li><li><a href=#135-å…¸å‹åº”ç”¨åœºæ™¯åˆ†æ>1.3.5 å…¸å‹åº”ç”¨åœºæ™¯åˆ†æ</a></li><li><a href=#æœ¬ç« å°ç»“>æœ¬ç« å°ç»“</a></li><li><a href=#æ€è€ƒä¸ç»ƒä¹ >æ€è€ƒä¸ç»ƒä¹ </a></li></ul></li><li><a href=#ç¬¬2ç« æ ¸å¿ƒæŠ½è±¡runnable-ä¸-lcel>ç¬¬2ç« ï¼šæ ¸å¿ƒæŠ½è±¡ï¼šRunnable ä¸ LCEL</a><ul><li><a href=#21-runnable-protocol>2.1 Runnable Protocol</a><ul><li><a href=#211-ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€æŠ½è±¡>2.1.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€æŠ½è±¡</a></li><li><a href=#212-æ ¸å¿ƒæ–¹æ³•invokestreambatch>2.1.2 æ ¸å¿ƒæ–¹æ³•ï¼šinvokeã€streamã€batch</a></li><li><a href=#213-å¼‚æ­¥æ–¹æ³•ainvokeastream>2.1.3 å¼‚æ­¥æ–¹æ³•ï¼šainvokeã€astream</a></li><li><a href=#214-runnable-ç±»å‹lambdaparallelbranchfallbacks>2.1.4 Runnable ç±»å‹ï¼šLambdaã€Parallelã€Branchã€Fallbacks</a></li></ul></li><li><a href=#22-lcel-è¡¨è¾¾å¼è¯­è¨€>2.2 LCEL è¡¨è¾¾å¼è¯­è¨€</a><ul><li><a href=#221-å£°æ˜å¼ç»„åˆç†å¿µ>2.2.1 å£°æ˜å¼ç»„åˆç†å¿µ</a></li><li><a href=#222-ç®¡é“æ“ä½œç¬¦--ä¸å¹¶è¡Œ->2.2.2 ç®¡é“æ“ä½œç¬¦ <code>|</code> ä¸å¹¶è¡Œ <code>{}</code></a></li><li><a href=#223-ç»„åˆæ¨¡å¼é¡ºåºå¹¶è¡Œæ¡ä»¶å¾ªç¯>2.2.3 ç»„åˆæ¨¡å¼ï¼šé¡ºåºã€å¹¶è¡Œã€æ¡ä»¶ã€å¾ªç¯</a></li></ul></li><li><a href=#23-é«˜çº§ç‰¹æ€§>2.3 é«˜çº§ç‰¹æ€§</a><ul><li><a href=#231-fallback-é™çº§ä¸-retry-é‡è¯•>2.3.1 Fallback é™çº§ä¸ Retry é‡è¯•</a></li><li><a href=#232-timeout-è¶…æ—¶æ§åˆ¶>2.3.2 Timeout è¶…æ—¶æ§åˆ¶</a></li><li><a href=#233-ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–>2.3.3 ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–</a></li></ul></li><li><a href=#æœ¬ç« å°ç»“-1>æœ¬ç« å°ç»“</a></li><li><a href=#æ€è€ƒä¸ç»ƒä¹ -1>æ€è€ƒä¸ç»ƒä¹ </a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=ç¬¬ä¸€ç¯‡åŸºç¡€è®¤çŸ¥>ç¬¬ä¸€ç¯‡ï¼šåŸºç¡€è®¤çŸ¥<a class=anchor href=#%e7%ac%ac%e4%b8%80%e7%af%87%e5%9f%ba%e7%a1%80%e8%ae%a4%e7%9f%a5>#</a></h1><hr><h2 id=-å‰ç½®å‡†å¤‡>ğŸ“‹ å‰ç½®å‡†å¤‡<a class=anchor href=#-%e5%89%8d%e7%bd%ae%e5%87%86%e5%a4%87>#</a></h2><h3 id=ç¯å¢ƒé…ç½®>ç¯å¢ƒé…ç½®<a class=anchor href=#%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae>#</a></h3><p>åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®Œæˆä»¥ä¸‹ç¯å¢ƒé…ç½®ï¼š</p><h4 id=1-python-ç‰ˆæœ¬>1. Python ç‰ˆæœ¬<a class=anchor href=#1-python-%e7%89%88%e6%9c%ac>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python --version  <span class=c1># éœ€è¦ Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬</span></span></span></code></pre></div><h4 id=2-å®‰è£…ä¾èµ–>2. å®‰è£…ä¾èµ–<a class=anchor href=#2-%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ä½¿ç”¨ pip å®‰è£…æœ€æ–°ç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl>pip install langchain langchain-openai langgraph langchain-community
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æˆ–ä½¿ç”¨ uv (æ¨è)</span>
</span></span><span class=line><span class=cl>uv pip install langchain langchain-openai langgraph langchain-community
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¦‚éœ€æŒ‡å®šç‰ˆæœ¬ï¼ˆæ¨èä½¿ç”¨1.0.7æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰</span>
</span></span><span class=line><span class=cl>pip install langchain&gt;<span class=o>=</span>1.0.7 langchain-openai&gt;<span class=o>=</span>1.0.3 langgraph&gt;<span class=o>=</span>1.0.3</span></span></code></pre></div><h4 id=3-ç¯å¢ƒå˜é‡é…ç½®>3. ç¯å¢ƒå˜é‡é…ç½®<a class=anchor href=#3-%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e9%85%8d%e7%bd%ae>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># åˆ›å»º .env æ–‡ä»¶</span>
</span></span><span class=line><span class=cl><span class=n>OPENAI_API_KEY</span><span class=o>=</span><span class=n>sk</span><span class=o>-</span><span class=n>your</span><span class=o>-</span><span class=n>api</span><span class=o>-</span><span class=n>key</span><span class=o>-</span><span class=n>here</span>
</span></span><span class=line><span class=cl><span class=n>LANGSMITH_API_KEY</span><span class=o>=</span><span class=n>your</span><span class=o>-</span><span class=n>langsmith</span><span class=o>-</span><span class=n>key</span>  <span class=c1># å¯é€‰,ç”¨äºç›‘æ§</span>
</span></span><span class=line><span class=cl><span class=n>LANGSMITH_TRACING</span><span class=o>=</span><span class=n>true</span>  <span class=c1># å¯é€‰</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åœ¨ä»£ç ä¸­åŠ è½½</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dotenv</span> <span class=kn>import</span> <span class=n>load_dotenv</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>load_dotenv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># éªŒè¯ç¯å¢ƒå˜é‡</span>
</span></span><span class=line><span class=cl><span class=n>required_vars</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;OPENAI_API_KEY&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>var</span> <span class=ow>in</span> <span class=n>required_vars</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=n>var</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>EnvironmentError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: </span><span class=si>{</span><span class=n>var</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></div><h4 id=4-ä¾èµ–ç‰ˆæœ¬æ¸…å•>4. ä¾èµ–ç‰ˆæœ¬æ¸…å•<a class=anchor href=#4-%e4%be%9d%e8%b5%96%e7%89%88%e6%9c%ac%e6%b8%85%e5%8d%95>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=c># pyproject.toml æ¨èé…ç½®</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>tool</span><span class=p>.</span><span class=nx>poetry</span><span class=p>.</span><span class=nx>dependencies</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>python</span> <span class=p>=</span> <span class=s2>&#34;^3.10&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>langchain</span> <span class=p>=</span> <span class=s2>&#34;^1.0.7&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>langchain-openai</span> <span class=p>=</span> <span class=s2>&#34;^1.0.3&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>langgraph</span> <span class=p>=</span> <span class=s2>&#34;^1.0.3&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>langchain-community</span> <span class=p>=</span> <span class=s2>&#34;^0.3.0&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>langchain-core</span> <span class=p>=</span> <span class=s2>&#34;^1.0.7&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>langsmith</span> <span class=p>=</span> <span class=s2>&#34;^0.4.43&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>python-dotenv</span> <span class=p>=</span> <span class=s2>&#34;^1.0.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># requirements.txt æ ¼å¼</span>
</span></span><span class=line><span class=cl><span class=c># langchain&gt;=1.0.7</span>
</span></span><span class=line><span class=cl><span class=c># langchain-openai&gt;=1.0.3</span>
</span></span><span class=line><span class=cl><span class=c># langgraph&gt;=1.0.3</span>
</span></span><span class=line><span class=cl><span class=c># langchain-community&gt;=0.3.0</span>
</span></span><span class=line><span class=cl><span class=c># langchain-core&gt;=1.0.7</span>
</span></span><span class=line><span class=cl><span class=c># langsmith&gt;=0.4.43</span>
</span></span><span class=line><span class=cl><span class=c># python-dotenv&gt;=1.0.0</span></span></span></code></pre></div><h3 id=å‰ç½®çŸ¥è¯†>å‰ç½®çŸ¥è¯†<a class=anchor href=#%e5%89%8d%e7%bd%ae%e7%9f%a5%e8%af%86>#</a></h3><p>å»ºè®®å…·å¤‡ä»¥ä¸‹åŸºç¡€çŸ¥è¯†ï¼š</p><ul><li>âœ… Python åŸºç¡€ (async/awaitã€ç±»å‹æ³¨è§£ã€è£…é¥°å™¨)</li><li>âœ… LLM åŸºæœ¬æ¦‚å¿µ (Promptã€Tokenã€Temperatureç­‰)</li><li>âœ… API è°ƒç”¨åŸºç¡€</li><li>âœ… JSON æ•°æ®æ ¼å¼</li></ul><hr><h2 id=ç¬¬1ç« langchain-ç”Ÿæ€å…¨æ™¯>ç¬¬1ç« ï¼šLangChain ç”Ÿæ€å…¨æ™¯<a class=anchor href=#%e7%ac%ac1%e7%ab%a0langchain-%e7%94%9f%e6%80%81%e5%85%a8%e6%99%af>#</a></h2><hr><h3 id=11-æ¶æ„å±‚æ¬¡å…³ç³»>1.1 æ¶æ„å±‚æ¬¡å…³ç³»<a class=anchor href=#11-%e6%9e%b6%e6%9e%84%e5%b1%82%e6%ac%a1%e5%85%b3%e7%b3%bb>#</a></h3><pre class=mermaid>graph TD
    A[åº”ç”¨å±‚&lt;br&gt;Deep Agents / LangGraph Projects] --&gt; B[ç¼–æ’å±‚&lt;br&gt;LangGraph]
    B --&gt; C[é“¾è·¯å±‚&lt;br&gt;LangChain / LCEL]
    C --&gt; D[ç›‘æ§å±‚&lt;br&gt;LangSmith]
    D --&gt; E[å¤–éƒ¨èµ„æº&lt;br&gt;Models / APIs / Tools]
    style A fill:#C7E8CA,stroke:#6CBF84,stroke-width:1px
    style B fill:#E4F3FF,stroke:#74B3E1,stroke-width:1px
    style C fill:#FFF5D7,stroke:#F0C94E,stroke-width:1px
    style D fill:#FFE4E1,stroke:#E87461,stroke-width:1px</pre><script src=/mermaid.min.js></script><script>mermaid.initialize({flowchart:{useMaxWidth:!0},theme:"default"})</script><p>LangChain ç”Ÿæ€ç³»ç»Ÿç›®å‰å·²å½¢æˆâ€œå¤šå±‚ååŒâ€çš„æ¶æ„ä½“ç³»ï¼Œæ—¢å¯æ”¯æŒå¿«é€ŸåŸå‹å¼€å‘ï¼Œä¹Ÿå¯æ”¯æ’‘ç”Ÿäº§çº§ LLM åº”ç”¨ã€‚æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š</p><table><thead><tr><th style=text-align:left>å±‚çº§</th><th style=text-align:left>æ ¸å¿ƒç»„ä»¶</th><th style=text-align:left>èŒè´£å®šä½</th><th style=text-align:left>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td style=text-align:left>åº”ç”¨å±‚</td><td style=text-align:left><strong>Deep Agents / LangGraph Projects</strong></td><td style=text-align:left>å¤æ‚è‡ªæ²» Agentã€é•¿æœŸè¿è¡Œã€å¤š Agent åä½œ</td><td style=text-align:left>æ™ºèƒ½åŠ©æ‰‹ã€è‡ªåŠ¨åŒ–ä»»åŠ¡ç³»ç»Ÿ</td></tr><tr><td style=text-align:left>ç¼–æ’å±‚</td><td style=text-align:left><strong>LangGraph</strong></td><td style=text-align:left>çŠ¶æ€åŒ–æµç¨‹æ§åˆ¶ã€èŠ‚ç‚¹æ‰§è¡Œã€åˆ†æ”¯å¾ªç¯</td><td style=text-align:left>å¤š Agent ç¼–æ’ã€å¯è§†åŒ–çŠ¶æ€æµ</td></tr><tr><td style=text-align:left>é“¾è·¯å±‚</td><td style=text-align:left><strong>LangChain / LCEL</strong></td><td style=text-align:left>æ¨¡å‹è°ƒç”¨ã€æç¤ºç®¡ç†ã€å·¥å…·é›†æˆ</td><td style=text-align:left>RAGã€é—®ç­”ã€å¯¹è¯</td></tr><tr><td style=text-align:left>ç›‘æ§å±‚</td><td style=text-align:left><strong>LangSmith</strong></td><td style=text-align:left>è°ƒè¯•ã€è§‚æµ‹ã€è¯„ä¼°ã€æˆæœ¬è¿½è¸ª</td><td style=text-align:left>DevOpsã€Evalsã€è´¨é‡ç›‘æ§</td></tr></tbody></table><h4 id=111-langchain-ä¸-langgraph-çš„å…³ç³»>1.1.1 LangChain ä¸ LangGraph çš„å…³ç³»<a class=anchor href=#111-langchain-%e4%b8%8e-langgraph-%e7%9a%84%e5%85%b3%e7%b3%bb>#</a></h4><p>LangChain ä¸“æ³¨äº <strong>é“¾å¼é€»è¾‘ä¸ Agent å°è£…</strong>ï¼›LangGraph ä¸“æ³¨äº <strong>æµç¨‹ç¼–æ’ä¸çŠ¶æ€ç®¡ç†</strong>ã€‚</p><ul><li><strong>LangChainï¼š</strong> ç”¨äºæ„å»ºå•æ¡æˆ–çº¿æ€§ chainï¼ˆPromptâ†’Modelâ†’Toolâ†’Outputï¼‰ã€‚</li><li><strong>LangGraphï¼š</strong> ç”¨äºç®¡ç†å«åˆ†æ”¯ã€å¾ªç¯ã€å¹¶å‘çš„å¤æ‚æµç¨‹ï¼ˆå¯è§†åŒ–ã€æŒä¹…åŒ–çŠ¶æ€ï¼‰ã€‚</li><li>äºŒè€…å¯å¹¶ç”¨ï¼šLangGraph ä¸­çš„èŠ‚ç‚¹å¯è¿è¡Œ LangChain æˆ– LCEL æ„é€ çš„ chainã€‚</li></ul><blockquote class=book-hint><p><strong>å›¾ 1-2 LangChain ä¸ LangGraph åä½œå…³ç³»å›¾</strong></p></blockquote><pre class=mermaid>graph LR
    A[&#34;LangChain Chain\n(Promptâ†’Modelâ†’Toolâ†’Output)&#34;]:::chain --&gt; B[&#34;LangGraph Node&#34;]:::node
    B --&gt; C[&#34;LangGraph Flow\n(å¤šèŠ‚ç‚¹ç¼–æ’ / çŠ¶æ€æŒä¹…åŒ–)&#34;]:::flow
    C --&gt; D[&#34;LangGraph Studio\n(å¯è§†åŒ–ä¸ç›‘æ§)&#34;]:::studio

    classDef chain fill:#FFF5D7,stroke:#F0C94E,stroke-width:1px;
    classDef node fill:#E4F3FF,stroke:#74B3E1,stroke-width:1px;
    classDef flow fill:#C7E8CA,stroke:#6CBF84,stroke-width:1px;
    classDef studio fill:#FFE4E1,stroke:#E87461,stroke-width:1px;</pre><h4 id=112-å¦‚ä½•æ„å»º-agent>1.1.2 å¦‚ä½•æ„å»º Agent<a class=anchor href=#112-%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba-agent>#</a></h4><p>LangChain 1.0+ æä¾›ç»Ÿä¸€çš„ Agent æ„å»ºæ¥å£ï¼š<strong><code>create_agent</code></strong></p><p><strong>å¿«é€Ÿå¼€å§‹ï¼šåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ª Agent</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain.agents</span> <span class=kn>import</span> <span class=n>create_agent</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.tools</span> <span class=kn>import</span> <span class=n>tool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ­¥éª¤1: å®šä¹‰å·¥å…·</span>
</span></span><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_weather</span><span class=p>(</span><span class=n>city</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>city</span><span class=si>}</span><span class=s2>ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œæ¸©åº¦25Â°C&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate</span><span class=p>(</span><span class=n>expression</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ•°å­¦è¡¨è¾¾å¼&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>expression</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;è®¡ç®—ç»“æœ: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;è®¡ç®—é”™è¯¯: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ­¥éª¤2: åˆ›å»º Agent</span>
</span></span><span class=line><span class=cl><span class=n>agent</span> <span class=o>=</span> <span class=n>create_agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=n>ChatOpenAI</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>tools</span><span class=o>=</span><span class=p>[</span><span class=n>get_weather</span><span class=p>,</span> <span class=n>calculate</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>system_prompt</span><span class=o>=</span><span class=s2>&#34;ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„åŠ©æ‰‹ï¼Œå¯ä»¥æŸ¥è¯¢å¤©æ°”å’Œè¿›è¡Œè®¡ç®—ã€‚&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ­¥éª¤3: è¿è¡Œ Agent</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>agent</span><span class=o>.</span><span class=n>invoke</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;messages&#34;</span><span class=p>:</span> <span class=p>[(</span><span class=s2>&#34;user&#34;</span><span class=p>,</span> <span class=s2>&#34;åŒ—äº¬å¤©æ°”å¦‚ä½•ï¼Ÿå¦å¤–å¸®æˆ‘ç®—ä¸€ä¸‹ 25 * 4&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ç»“æœ</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&#34;messages&#34;</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>content</span><span class=p>)</span></span></span></code></pre></div><p><strong>è¾“å‡ºç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>åŒ—äº¬ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œæ¸©åº¦25Â°Cã€‚
</span></span><span class=line><span class=cl>25 * 4 çš„è®¡ç®—ç»“æœæ˜¯ 100ã€‚</span></span></code></pre></div><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong></p><p><strong><code>create_agent</code> çš„å·¥ä½œåŸç†</strong>ï¼š</p><pre class=mermaid>graph LR
    A[ç”¨æˆ·è¾“å…¥] --&gt; B[Agent æ¥æ”¶]
    B --&gt; C[LLM åˆ†æ]
    C --&gt; D{éœ€è¦å·¥å…·?}
    D -- æ˜¯ --&gt; E[è°ƒç”¨å·¥å…·]
    E --&gt; F[è·å–ç»“æœ]
    F --&gt; C
    D -- å¦ --&gt; G[ç”Ÿæˆå›å¤]
    G --&gt; H[è¿”å›ç”¨æˆ·]</pre><p><strong>å…³é”®å‚æ•°è¯´æ˜</strong>ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>å¿…éœ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>model</code></td><td>ChatModel | str</td><td>âœ…</td><td>ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹</td></tr><tr><td><code>tools</code></td><td>List[Tool]</td><td>âœ…</td><td>å¯ç”¨çš„å·¥å…·åˆ—è¡¨</td></tr><tr><td><code>system_prompt</code></td><td>str</td><td>âŒ</td><td>ç³»ç»Ÿæç¤ºè¯ï¼Œå®šä¹‰ Agent è¡Œä¸º</td></tr><tr><td><code>checkpointer</code></td><td>Checkpointer</td><td>âŒ</td><td>çŠ¶æ€æŒä¹…åŒ–ï¼ˆç”¨äºå¤šè½®å¯¹è¯ï¼‰</td></tr><tr><td><code>interrupt_before</code></td><td>List[str]</td><td>âŒ</td><td>åœ¨æŒ‡å®šèŠ‚ç‚¹å‰æš‚åœï¼ˆéœ€è¦äººå·¥ç¡®è®¤ï¼‰</td></tr><tr><td><code>interrupt_after</code></td><td>List[str]</td><td>âŒ</td><td>åœ¨æŒ‡å®šèŠ‚ç‚¹åæš‚åœ</td></tr></tbody></table><p><strong>å®Œæ•´å·¥ä½œæµç¨‹</strong></p><ol><li><strong>æ¨¡å‹ç»‘å®š</strong>ï¼šæŒ‡å®šä½¿ç”¨çš„ LLMï¼ˆå¦‚ GPT-4ã€Claude ç­‰ï¼‰</li><li><strong>å·¥å…·æ³¨å†Œ</strong>ï¼šæä¾› Agent å¯è°ƒç”¨çš„å·¥å…·é›†åˆ</li><li><strong>æç¤ºé…ç½®</strong>ï¼šé€šè¿‡ <code>system_prompt</code> å®šä¹‰ Agent çš„è§’è‰²å’Œè¡Œä¸º</li><li><strong>å†³ç­–æ‰§è¡Œ</strong>ï¼šLLM åŸºäº ReAct æ¨¡å¼è‡ªåŠ¨å†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·</li><li><strong>ç»“æœè¿”å›</strong>ï¼šè‡ªåŠ¨ç»„åˆå·¥å…·è¾“å‡ºå’Œ LLM å›å¤</li><li><strong>ç›‘æ§è¿½è¸ª</strong>ï¼šé›†æˆ LangSmith å®ç°å…¨é“¾è·¯è¿½è¸ª</li></ol><p><strong>å…³é”®ç‰¹æ€§</strong></p><ul><li>âœ… <strong>å®˜æ–¹æ¨è</strong>ï¼šLangChain 1.0+ æ ‡å‡† API</li><li>âœ… <strong>ç®€æ´æ˜“ç”¨</strong>ï¼šç»Ÿä¸€çš„æ¥å£ï¼Œ3æ­¥å³å¯åˆ›å»º Agent</li><li>âœ… <strong>å®Œæ•´åŠŸèƒ½</strong>ï¼šæ”¯æŒ middlewareã€cacheã€checkpointer</li><li>âœ… <strong>è‡ªåŠ¨å·¥å…·è°ƒç”¨</strong>ï¼šLLM è‡ªåŠ¨åˆ¤æ–­ä½•æ—¶ä½¿ç”¨å“ªä¸ªå·¥å…·</li><li>âœ… <strong>å¤šè½®å¯¹è¯</strong>ï¼šæ”¯æŒçŠ¶æ€æŒä¹…åŒ–ï¼Œå®ç°ä¸Šä¸‹æ–‡è®°å¿†</li><li>âœ… <strong>é•¿æœŸæ”¯æŒ</strong>ï¼šå®˜æ–¹ç»´æŠ¤ï¼ŒæŒç»­æ›´æ–°</li></ul><pre class=mermaid>graph LR
    A[Prompt Template] --&gt; B[LLM / ChatModel]
    B --&gt; C[Tool Selection]
    C --&gt; D[Tool Execution]
    D --&gt; E[Parser / Output Formatter]
    E --&gt; F[è¿”å›ç»“æœ]
    F --&gt; G[LangSmith Callback / Tracing]</pre><hr><h4 id=113-lcel-çš„å®šä½ä¸ä½œç”¨>1.1.3 LCEL çš„å®šä½ä¸ä½œç”¨<a class=anchor href=#113-lcel-%e7%9a%84%e5%ae%9a%e4%bd%8d%e4%b8%8e%e4%bd%9c%e7%94%a8>#</a></h4><p>LCELï¼ˆLangChain Expression Languageï¼‰æ˜¯ LangChain çš„â€œå£°æ˜å¼ç»„åˆè¯­æ³•â€ï¼Œç”¨äº <strong>æ„å»ºå¯å¹¶è¡Œã€å¯æµå¼ã€å¯è¿½è¸ªçš„ Runnable é“¾</strong>ã€‚</p><ul><li><strong>æ ¸å¿ƒæ¦‚å¿µï¼š</strong><ul><li><code>RunnableSequence</code> é¡ºåºæ‰§è¡Œï¼›</li><li><code>RunnableParallel</code> å¹¶è¡Œæ‰§è¡Œï¼›</li><li>æ”¯æŒ async / stream / batch ç»Ÿä¸€è°ƒç”¨ï¼›</li><li>å¯ç›´æ¥åµŒå…¥ LangGraph èŠ‚ç‚¹ã€‚</li></ul></li><li><strong>ä»·å€¼ï¼š</strong> åœ¨ä»£ç å±‚é¢æ„å»ºâ€œæ•°æ®æµç®¡çº¿â€ï¼Œå¦‚åŒ Node-RED æˆ– Airflow çš„è½»é‡åŒ–å®ç°ã€‚</li></ul><pre class=mermaid>graph TD
    A[&#34;è¾“å…¥æ•°æ®&#34;]:::input --&gt; B[&#34;RunnableSequence(é¡ºåºæ‰§è¡Œ)&#34;]:::seq
    B --&gt; C[&#34;RunnableParallel(å¹¶è¡Œæ‰§è¡Œ)&#34;]:::par
    C --&gt; D[&#34;æ¨¡å‹æ¨ç† / å·¥å…·è°ƒç”¨&#34;]:::model
    D --&gt; E[&#34;æµå¼è¾“å‡º / ç»“æ„åŒ–è§£æ&#34;]:::output

    classDef input fill:#E3F2FD,stroke:#64B5F6,stroke-width:1px;
    classDef seq fill:#FFF9C4,stroke:#FDD835,stroke-width:1px;
    classDef par fill:#DCEDC8,stroke:#81C784,stroke-width:1px;
    classDef model fill:#F0F4C3,stroke:#C0CA33,stroke-width:1px;
    classDef output fill:#FFE0B2,stroke:#FB8C00,stroke-width:1px;</pre><h4 id=114-langsmith-çš„ç›‘æ§èŒè´£>1.1.4 LangSmith çš„ç›‘æ§èŒè´£<a class=anchor href=#114-langsmith-%e7%9a%84%e7%9b%91%e6%8e%a7%e8%81%8c%e8%b4%a3>#</a></h4><p>LangSmith æ˜¯ LangChain å®˜æ–¹æ¨å‡ºçš„å¯è§‚æµ‹æ€§ä¸è´¨é‡è¯„ä¼°å¹³å°ã€‚</p><p><strong>ä¸»è¦èŒè´£ï¼š</strong></p><ul><li>ğŸ” <strong>Tracing</strong> ï¼šè¿½è¸ª Chain/Graph/Agent æ¯ä¸ªè°ƒç”¨èŠ‚ç‚¹ã€‚</li><li>ğŸ“ˆ <strong>Metrics</strong> ï¼šç›‘æ§å»¶è¿Ÿã€Token ç”¨é‡ã€é”™è¯¯ç‡ã€æˆæœ¬ã€‚</li><li>ğŸ§ª <strong>Evaluation</strong> ï¼šå¯¹æ¨¡å‹æˆ– Agent è¾“å‡ºè¿›è¡Œæ‰“åˆ†ä¸å¯¹æ¯”ã€‚</li><li>âš™ï¸ <strong>Integration</strong> ï¼šä¸ LangChain ã€LangGraph ã€Deep Agents åŸç”Ÿé›†æˆã€‚</li></ul><pre class=mermaid>graph LR
    subgraph LangSmith
    A[Tracing&lt;br&gt;é“¾è·¯è¿½è¸ª] --&gt; B[Metrics&lt;br&gt;æ€§èƒ½&amp;æˆæœ¬]
    B --&gt; C[Evals&lt;br&gt;æ¨¡å‹è¯„ä¼°]
    C --&gt; D[Dashboard / Report]
    end
    D --&gt; E[å¼€å‘è€… / å›¢é˜Ÿåä½œ]</pre><h3 id=12-æ ¸å¿ƒè®¾è®¡ç†å¿µ>1.2 æ ¸å¿ƒè®¾è®¡ç†å¿µ<a class=anchor href=#12-%e6%a0%b8%e5%bf%83%e8%ae%be%e8%ae%a1%e7%90%86%e5%bf%b5>#</a></h3><pre class=mermaid>mindmap
  root((LangChain Design))
    Provider-Agnostic
      å¤šæ¨¡å‹å…¼å®¹
      å¿«é€Ÿåˆ‡æ¢
    Runnable Protocol
      ç»Ÿä¸€æ¥å£
      å¯ç»„åˆæ‰§è¡Œ
    Middleware Driven
      Hook/Callback
      Metrics/Retry
    Production First
      ç¨³å®šæ€§
      å¯è§‚æµ‹æ€§
      æˆæœ¬æ§åˆ¶</pre><h4 id=121-provider-agnostic-è®¾è®¡>1.2.1 Provider-Agnostic è®¾è®¡<a class=anchor href=#121-provider-agnostic-%e8%ae%be%e8%ae%a1>#</a></h4><p>LangChain é€šè¿‡ç»Ÿä¸€æ¥å£å±è”½ LLM æä¾›å•†å·®å¼‚ï¼ˆOpenAIã€Anthropicã€Cohereã€Azure ç­‰ï¼‰ï¼Œ<br>ä»¥ â€œProvider æ— å…³â€ çš„æ–¹å¼æ„å»ºåº”ç”¨ã€‚</p><ul><li>æ¨¡å‹åˆ‡æ¢æ— éœ€ä¿®æ”¹ä¸Šå±‚é€»è¾‘ã€‚</li><li>æ”¯æŒè·¨å¹³å°æˆæœ¬è¿½è¸ªä¸æ€§èƒ½æ¯”è¾ƒã€‚</li></ul><h4 id=122-runnable-protocol-ç»Ÿä¸€æŠ½è±¡>1.2.2 Runnable Protocol ç»Ÿä¸€æŠ½è±¡<a class=anchor href=#122-runnable-protocol-%e7%bb%9f%e4%b8%80%e6%8a%bd%e8%b1%a1>#</a></h4><p>Runnable æ˜¯ LangChain çš„æ ¸å¿ƒæ‰§è¡Œåè®®ï¼š</p><blockquote class=book-hint><p>ä¸€åˆ‡çš† Runnableã€‚</p></blockquote><p>åŒ…æ‹¬ Chainã€Agentã€Toolã€Prompt å‡å®ç°è¯¥æ¥å£ã€‚</p><ul><li>ç»Ÿä¸€æ‰§è¡Œå…¥å£ï¼š<code>invoke()</code>ã€<code>ainvoke()</code>ã€<code>stream()</code>ã€‚</li><li>æ”¯æŒå¼‚æ­¥ã€æ‰¹é‡ã€æµå¼ã€å¯è¿½è¸ªè°ƒç”¨ã€‚</li><li>æ‰€æœ‰ Runnable å¯åµŒå¥—ã€ç»„åˆã€è£…é¥°ã€‚</li></ul><pre class=mermaid>graph TD
    A[Runnable] --&gt; B[Chain]
    A --&gt; C[Agent]
    A --&gt; D[Tool]
    A --&gt; E[Prompt]
    A --&gt; F[LCEL ç»„åˆç»“æ„]</pre><h4 id=123-middleware-driven-æ¶æ„>1.2.3 Middleware-Driven æ¶æ„<a class=anchor href=#123-middleware-driven-%e6%9e%b6%e6%9e%84>#</a></h4><p>LangChain æ”¯æŒ Callback / Hook / Tracing æœºåˆ¶ï¼Œå¯åœ¨æ‰§è¡Œæµä¸­æ’å…¥ä¸­é—´ä»¶ã€‚</p><p>å¸¸è§ä¸­é—´ä»¶ç”¨é€”ï¼š</p><ul><li>Token è®¡æ•°ä¸æˆæœ¬ç›‘æ§</li><li>æ—¥å¿—ä¸é”™è¯¯è¿½è¸ª</li><li>å®‰å…¨å®¡æŸ¥ä¸è®¿é—®æ§åˆ¶</li><li>é‡è¯•ä¸è¶…æ—¶æ§åˆ¶</li></ul><pre class=mermaid>sequenceDiagram
    participant U as User
    participant C as Chain/Agent
    participant M as Middleware
    participant L as LangSmith

    U-&gt;&gt;C: è°ƒç”¨æ‰§è¡Œ
    C-&gt;&gt;M: è¿›å…¥ä¸­é—´ä»¶ (tokenè®¡æ•°/æ—¥å¿—)
    M-&gt;&gt;L: ä¸ŠæŠ¥ç›‘æ§æ•°æ®
    L--&gt;&gt;M: è¿”å›ç›‘æ§ç»“æœ
    M--&gt;&gt;C: æ‰§è¡Œä¸»æµç¨‹
    C--&gt;&gt;U: è¿”å›è¾“å‡ºç»“æœ</pre><h4 id=124-production-first-ç†å¿µ>1.2.4 Production-First ç†å¿µ<a class=anchor href=#124-production-first-%e7%90%86%e5%bf%b5>#</a></h4><p>LangChain 1.0 åŠ LangGraph 1.0 å‘å¸ƒåï¼Œç”Ÿæ€å…¨é¢è½¬å‘ <strong>ç”Ÿäº§çº§ç¨³å®šæ€§ä¸å¯è§‚æµ‹æ€§</strong>ã€‚<br>æ ¸å¿ƒç›®æ ‡åŒ…æ‹¬ï¼š</p><ul><li>é•¿æœŸå…¼å®¹ï¼ˆå‘ 2.0 å¹³æ»‘è¿‡æ¸¡ï¼‰</li><li>æˆæœ¬å¯æ§ï¼ˆLangSmith ç›‘æ§ + è‡ªåŠ¨è®¡è´¹ï¼‰</li><li>æ¨¡å‹çƒ­æ›¿æ¢ï¼ˆProvider-agnosticï¼‰</li><li>å®Œæ•´ CI/CD ä¸ Evals é›†æˆ</li></ul><pre class=mermaid>flowchart LR
    A[å¼€å‘é˜¶æ®µ&lt;br&gt;LangChain Prototype] --&gt; B[æµ‹è¯•é˜¶æ®µ&lt;br&gt;LangSmith è°ƒè¯•]
    B --&gt; C[éƒ¨ç½²é˜¶æ®µ&lt;br&gt;LangGraph ç¼–æ’]
    C --&gt; D[ç›‘æ§é˜¶æ®µ&lt;br&gt;Metrics / Evals]
    D --&gt; E[æŒç»­ä¼˜åŒ–&lt;br&gt;æ¨¡å‹&amp;æç¤ºè°ƒæ•´]</pre><h3 id=13-æŠ€æœ¯é€‰å‹å†³ç­–æ ‘>1.3 æŠ€æœ¯é€‰å‹å†³ç­–æ ‘<a class=anchor href=#13-%e6%8a%80%e6%9c%af%e9%80%89%e5%9e%8b%e5%86%b3%e7%ad%96%e6%a0%91>#</a></h3><pre class=mermaid>graph TD
    A[åº”ç”¨éœ€æ±‚è¯„ä¼°] --&gt; B{æµç¨‹æ˜¯å¦å¤æ‚?}
    B -- å¦ --&gt; C[ä½¿ç”¨ create_agent&lt;br&gt;LangChain å¿«é€ŸåŸå‹]
    B -- æ˜¯ --&gt; D{æ˜¯å¦éœ€è¦çŠ¶æ€ç®¡ç†?}
    D -- å¦ --&gt; E[ä½¿ç”¨ LCEL æ„å»º chain]
    D -- æ˜¯ --&gt; F{æ˜¯å¦ä¸ºé•¿æœŸè¿è¡Œ/è‡ªæ²»?}
    F -- å¦ --&gt; G[ä½¿ç”¨ LangGraph ç¼–æ’]
    F -- æ˜¯ --&gt; H[ä½¿ç”¨ Deep Agents&lt;br&gt;ç»“åˆ LangSmith ç›‘æ§]</pre><h3 id=131-ä½•æ—¶ä½¿ç”¨-create_agent>1.3.1 ä½•æ—¶ä½¿ç”¨ create_agent<a class=anchor href=#131-%e4%bd%95%e6%97%b6%e4%bd%bf%e7%94%a8-create_agent>#</a></h3><p>é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>å• Agent æ‰§è¡Œï¼Œæµç¨‹çº¿æ€§ï¼›</li><li>éœ€è¦å¿«é€Ÿå®ç° Tool è°ƒç”¨ï¼›</li><li>ç”¨äº RAG ã€é—®ç­”ã€åŠ©æ‰‹ç±»åœºæ™¯ã€‚</li></ul><h3 id=132-ä½•æ—¶æ·±å…¥-langgraph>1.3.2 ä½•æ—¶æ·±å…¥ LangGraph<a class=anchor href=#132-%e4%bd%95%e6%97%b6%e6%b7%b1%e5%85%a5-langgraph>#</a></h3><p>é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>å¤š Agent åä½œï¼›</li><li>å­˜åœ¨åˆ†æ”¯ / å¾ªç¯ / çŠ¶æ€ç®¡ç†ï¼›</li><li>éœ€å¯è§†åŒ–ã€å¯è°ƒè¯•ã€æŒä¹…åŒ–è¿è¡Œã€‚</li></ul><h3 id=133-ä½•æ—¶ä½¿ç”¨-deep-agents>1.3.3 ä½•æ—¶ä½¿ç”¨ Deep Agents<a class=anchor href=#133-%e4%bd%95%e6%97%b6%e4%bd%bf%e7%94%a8-deep-agents>#</a></h3><p>é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>é•¿æœŸè¿è¡Œã€è‡ªä¸»å†³ç­– Agentï¼›</li><li>å¤æ‚ä»»åŠ¡æ‹†è§£ã€å­ Agent ç®¡ç†ï¼›</li><li>æŒç»­ä»»åŠ¡æ‰§è¡Œä¸å‘¨æœŸæ€§è§¦å‘ã€‚</li></ul><h3 id=134-ä½•æ—¶éœ€è¦-middleware>1.3.4 ä½•æ—¶éœ€è¦ Middleware<a class=anchor href=#134-%e4%bd%95%e6%97%b6%e9%9c%80%e8%a6%81-middleware>#</a></h3><p>é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>ç”Ÿäº§ç¯å¢ƒè¿è¡Œï¼›</li><li>éœ€è¦æ—¥å¿—ã€æŒ‡æ ‡ã€å®‰å…¨æ§åˆ¶ã€å›è°ƒã€‚<br>æ¨èï¼šæ‰€æœ‰ Chain/Agent å‡å¯ç”¨ LangSmith Tracing + è‡ªå®šä¹‰ Callbackã€‚</li></ul><h3 id=135-å…¸å‹åº”ç”¨åœºæ™¯åˆ†æ>1.3.5 å…¸å‹åº”ç”¨åœºæ™¯åˆ†æ<a class=anchor href=#135-%e5%85%b8%e5%9e%8b%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%e5%88%86%e6%9e%90>#</a></h3><table><thead><tr><th style=text-align:left>åœºæ™¯</th><th style=text-align:left>æ¨èæŠ€æœ¯</th><th style=text-align:left>ç†ç”±</th></tr></thead><tbody><tr><td style=text-align:left>A. ä¼ä¸šæ–‡æ¡£é—®ç­”</td><td style=text-align:left>create_agent + LCEL</td><td style=text-align:left>å¿«é€Ÿæ„å»º RAG é—®ç­”</td></tr><tr><td style=text-align:left>B. æ™ºèƒ½å®¢æœç³»ç»Ÿ</td><td style=text-align:left>LangChain Agent + Middleware</td><td style=text-align:left>éœ€å¤šè½®å¯¹è¯ä¸ç›‘æ§</td></tr><tr><td style=text-align:left>C. è‡ªåŠ¨åŒ–ä»»åŠ¡ç®¡ç†</td><td style=text-align:left>LangGraph + Deep Agents + LangSmith</td><td style=text-align:left>å¤æ‚ workflow + è‡ªæ²» agent</td></tr><tr><td style=text-align:left>D. å†…å®¹æ‘˜è¦æˆ–è½¬æ¢</td><td style=text-align:left>LCEL</td><td style=text-align:left>è½»é‡ã€é«˜å¹¶è¡Œã€å¯æµå¼</td></tr></tbody></table><hr><h3 id=æœ¬ç« å°ç»“>æœ¬ç« å°ç»“<a class=anchor href=#%e6%9c%ac%e7%ab%a0%e5%b0%8f%e7%bb%93>#</a></h3><p>LangChain ç”Ÿæ€ä½“ç³»å¯æ¦‚æ‹¬ä¸ºï¼š</p><blockquote class=book-hint><p><strong>é“¾å¼é€»è¾‘ï¼ˆLangChainï¼‰ â†’ å›¾å¼ç¼–æ’ï¼ˆLangGraphï¼‰ â†’ ç›‘æ§è¯„ä¼°ï¼ˆLangSmithï¼‰ â†’ è‡ªæ²»è¿›åŒ–ï¼ˆDeep Agentsï¼‰</strong></p></blockquote><p>æ ¸å¿ƒç†å¿µï¼š</p><ul><li>Provider-Agnostic</li><li>Runnable ç»Ÿä¸€æŠ½è±¡</li><li>Middleware å¯æ’æ¶æ„</li><li>Production-First éƒ¨ç½²æ€ç»´</li></ul><p>è®¾è®¡å“²å­¦ä¸Šï¼Œä»â€œç©å…·åŸå‹â€èµ°å‘â€œç”Ÿäº§å¯è§‚æµ‹â€çš„å·¥ç¨‹ç³»ç»Ÿã€‚</p><h3 id=æ€è€ƒä¸ç»ƒä¹ >æ€è€ƒä¸ç»ƒä¹ <a class=anchor href=#%e6%80%9d%e8%80%83%e4%b8%8e%e7%bb%83%e4%b9%a0>#</a></h3><ol><li><p><strong>ç»ƒä¹  1ï¼š</strong>
é€‰æ‹©ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œç”»å‡ºå…¶ LangChain æŠ€æœ¯é€‰å‹å†³ç­–è·¯å¾„ã€‚</p></li><li><p><strong>ç»ƒä¹  2ï¼š</strong>
ç¼–å†™ä¸€ä¸ª LCEL ä¾‹ç¨‹ï¼ˆPrompt â†’ Model â†’ Parser â†’ Toolï¼‰ï¼Œå¹¶æ ‡æ³¨ä½ ä¼šæ’å…¥å“ªäº› Middlewareã€‚</p></li><li><p><strong>ç»ƒä¹  3ï¼š</strong>
è®¾è®¡ä¸€ä¸ªé•¿æœŸè¿è¡Œ Agent ï¼ˆå¦‚ å¸‚åœºç›‘æ§æˆ–è‡ªåŠ¨æŠ¥å‘Šï¼‰ï¼Œè¯´æ˜å¦‚ä½•ç”¨ LangGraph + LangSmith å®ç°ç›‘æ§ä¸ Evalsã€‚</p></li><li><p><strong>æ€è€ƒé¢˜ï¼š</strong>
LCEL åœ¨ LangGraph èŠ‚ç‚¹ä¸­åµŒå¥—ä½¿ç”¨ä¼šå¸¦æ¥å“ªäº›ä¼˜åŠ¿ä¸ä»£ä»·ï¼Ÿ</p></li></ol><hr><h2 id=ç¬¬2ç« æ ¸å¿ƒæŠ½è±¡runnable-ä¸-lcel>ç¬¬2ç« ï¼šæ ¸å¿ƒæŠ½è±¡ï¼šRunnable ä¸ LCEL<a class=anchor href=#%e7%ac%ac2%e7%ab%a0%e6%a0%b8%e5%bf%83%e6%8a%bd%e8%b1%a1runnable-%e4%b8%8e-lcel>#</a></h2><h3 id=21-runnable-protocol>2.1 Runnable Protocol<a class=anchor href=#21-runnable-protocol>#</a></h3><h4 id=211-ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€æŠ½è±¡>2.1.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€æŠ½è±¡<a class=anchor href=#211-%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e7%bb%9f%e4%b8%80%e6%8a%bd%e8%b1%a1>#</a></h4><p>åœ¨ LangChain 1.0 ä¹‹å‰ï¼Œä¸åŒç»„ä»¶ï¼ˆPromptã€Modelã€Toolã€Chainï¼‰çš„è°ƒç”¨æ–¹å¼å„ä¸ç›¸åŒï¼Œå¯¼è‡´ï¼š</p><ul><li><strong>æ¥å£ä¸ä¸€è‡´</strong>ï¼šå­¦ä¹ æˆæœ¬é«˜ï¼Œéš¾ä»¥ç»„åˆ</li><li><strong>ç¼ºä¹æ ‡å‡†åŒ–</strong>ï¼šæ— æ³•ç»Ÿä¸€è¿½è¸ªã€ç›‘æ§</li><li><strong>ç»„åˆå›°éš¾</strong>ï¼šä¸åŒç»„ä»¶éš¾ä»¥åµŒå¥—ä½¿ç”¨</li></ul><p><strong>Runnable Protocol è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><p>LangChain 1.0 å¼•å…¥ Runnable ä½œä¸º<strong>ç»Ÿä¸€æ‰§è¡Œåè®®</strong>ï¼Œæ‰€æœ‰ç»„ä»¶å‡å®ç°è¯¥æ¥å£ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.runnables</span> <span class=kn>import</span> <span class=n>Runnable</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰€æœ‰ç»„ä»¶å‡å®ç° Runnable æ¥å£</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Runnable</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>invoke</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>input</span><span class=p>,</span> <span class=n>config</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span> <span class=o>...</span>       <span class=c1># åŒæ­¥è°ƒç”¨</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>ainvoke</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>input</span><span class=p>,</span> <span class=n>config</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span> <span class=o>...</span>      <span class=c1># å¼‚æ­¥è°ƒç”¨</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>stream</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>input</span><span class=p>,</span> <span class=n>config</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span> <span class=o>...</span>       <span class=c1># æµå¼è¾“å‡º</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>astream</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>input</span><span class=p>,</span> <span class=n>config</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span> <span class=o>...</span>      <span class=c1># å¼‚æ­¥æµå¼</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>batch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>inputs</span><span class=p>,</span> <span class=n>config</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span> <span class=o>...</span>       <span class=c1># æ‰¹é‡å¤„ç†</span></span></span></code></pre></div><p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p><pre class=mermaid>graph LR
    A[Runnable ç»Ÿä¸€æŠ½è±¡] --&gt; B[ä¸€è‡´çš„è°ƒç”¨æ–¹å¼]
    A --&gt; C[å¯ç»„åˆæ€§]
    A --&gt; D[å¯è¿½è¸ªæ€§]
    A --&gt; E[è‡ªåŠ¨ä¼˜åŒ–]

    B --&gt; F[é™ä½å­¦ä¹ æˆæœ¬]
    C --&gt; G[LCEL ç®¡é“]
    D --&gt; H[LangSmith é›†æˆ]
    E --&gt; I[æ‰¹å¤„ç†/å¹¶è¡Œ]</pre><p><strong>å®é™…åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.output_parsers</span> <span class=kn>import</span> <span class=n>StrOutputParser</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯ Runnable</span>
</span></span><span class=line><span class=cl><span class=n>prompt</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_template</span><span class=p>(</span><span class=s2>&#34;Tell me a joke about </span><span class=si>{topic}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>parser</span> <span class=o>=</span> <span class=n>StrOutputParser</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç»Ÿä¸€çš„è°ƒç”¨æ–¹å¼</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>prompt</span><span class=o>.</span><span class=n>invoke</span><span class=p>({</span><span class=s2>&#34;topic&#34;</span><span class=p>:</span> <span class=s2>&#34;AI&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;Tell me a joke&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;some text&#34;</span><span class=p>)</span></span></span></code></pre></div><hr><h4 id=212-æ ¸å¿ƒæ–¹æ³•invokestreambatch>2.1.2 æ ¸å¿ƒæ–¹æ³•ï¼šinvokeã€streamã€batch<a class=anchor href=#212-%e6%a0%b8%e5%bf%83%e6%96%b9%e6%b3%95invokestreambatch>#</a></h4><p><strong>invoke() - åŒæ­¥è°ƒç”¨</strong></p><p>æœ€åŸºç¡€çš„è°ƒç”¨æ–¹å¼ï¼Œé€‚ç”¨äºå•æ¬¡è¯·æ±‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åŒæ­¥è°ƒç”¨</span>
</span></span><span class=line><span class=cl><span class=n>response</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;What is LangChain?&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>content</span><span class=p>)</span></span></span></code></pre></div><p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p><pre class=mermaid>sequenceDiagram
    participant User
    participant Runnable
    participant LLM
    participant LangSmith

    User-&gt;&gt;Runnable: invoke(input)
    Runnable-&gt;&gt;LangSmith: å¼€å§‹è¿½è¸ª
    Runnable-&gt;&gt;LLM: å‘é€è¯·æ±‚
    LLM--&gt;&gt;Runnable: è¿”å›å®Œæ•´ç»“æœ
    Runnable-&gt;&gt;LangSmith: è®°å½•ç»“æœ
    Runnable--&gt;&gt;User: è¿”å›è¾“å‡º</pre><p><strong>stream() - æµå¼è¾“å‡º</strong></p><p>é€‚ç”¨äºéœ€è¦å®æ—¶åé¦ˆçš„åœºæ™¯ï¼ˆå¦‚èŠå¤©ç•Œé¢ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># æµå¼è¾“å‡º</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>chunk</span> <span class=ow>in</span> <span class=n>model</span><span class=o>.</span><span class=n>stream</span><span class=p>(</span><span class=s2>&#34;Tell me a long story&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>chunk</span><span class=o>.</span><span class=n>content</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></span></span></code></pre></div><p><strong>æµå¼è¾“å‡ºçš„ä¼˜åŠ¿</strong>ï¼š</p><ul><li>âœ… é™ä½é¦–å­—å»¶è¿Ÿï¼ˆTTFT - Time To First Tokenï¼‰</li><li>âœ… æå‡ç”¨æˆ·ä½“éªŒï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰</li><li>âœ… å‡å°‘è¶…æ—¶é£é™©</li></ul><pre class=mermaid>graph LR
    A[User Request] --&gt; B[Stream Token 1]
    B --&gt; C[Stream Token 2]
    C --&gt; D[Stream Token 3]
    D --&gt; E[...]
    E --&gt; F[Stream Complete]

    style B fill:#E8F5E9
    style C fill:#E8F5E9
    style D fill:#E8F5E9</pre><p><strong>batch() - æ‰¹é‡å¤„ç†</strong></p><p>é€‚ç”¨äºæ‰¹é‡è¯·æ±‚åœºæ™¯ï¼Œè‡ªåŠ¨ä¼˜åŒ–å¹¶å‘ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># æ‰¹é‡å¤„ç†ï¼ˆè‡ªåŠ¨å¹¶å‘ä¼˜åŒ–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>inputs</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;What is AI?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;What is ML?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;What is LLM?&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>batch</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>content</span><span class=p>)</span></span></span></code></pre></div><p><strong>æ‰¹é‡å¤„ç†çš„ä¼˜åŠ¿</strong>ï¼š</p><ul><li>âœ… è‡ªåŠ¨å¹¶å‘æ§åˆ¶</li><li>âœ… æˆæœ¬è¿½è¸ªèšåˆ</li><li>âœ… é”™è¯¯å¤„ç†ä¼˜åŒ–</li></ul><pre class=mermaid>graph TD
    A[Batch Inputs] --&gt; B[å¹¶å‘æ§åˆ¶å™¨]
    B --&gt; C[Request 1]
    B --&gt; D[Request 2]
    B --&gt; E[Request 3]
    C --&gt; F[ç»“æœèšåˆ]
    D --&gt; F
    E --&gt; F
    F --&gt; G[Batch Results]</pre><p><strong>abatch() - å¼‚æ­¥æ‰¹é‡å¤„ç†</strong></p><p>åœ¨éœ€è¦é«˜å¹¶å‘å¤„ç†å¤§é‡è¯·æ±‚æ—¶ï¼Œ<code>abatch()</code> æ¯”åŒæ­¥ <code>batch()</code> æ€§èƒ½æ›´å¥½ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>async_batch_example</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>inputs</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;What is AI?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;What is ML?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;What is LLM?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;What is NLP?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;What is DL?&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å¼‚æ­¥æ‰¹é‡å¤„ç†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>model</span><span class=o>.</span><span class=n>abatch</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>results</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Result </span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>content</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¿è¡Œå¼‚æ­¥ä»»åŠ¡</span>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>async_batch_example</span><span class=p>())</span></span></span></code></pre></div><p><strong>abatch ä¸ batch çš„å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>é€‚ç”¨åœºæ™¯</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td><code>batch()</code></td><td>ä¸­å°æ‰¹é‡ï¼ˆ&lt;50ï¼‰</td><td>å®ç°ç®€å•ï¼Œæ— éœ€async/await</td></tr><tr><td><code>abatch()</code></td><td>å¤§æ‰¹é‡ï¼ˆ50+ï¼‰ã€I/Oå¯†é›†</td><td>æ›´é«˜å¹¶å‘æ€§èƒ½ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜</td></tr></tbody></table><hr><h4 id=213-å¼‚æ­¥æ–¹æ³•ainvokeastream>2.1.3 å¼‚æ­¥æ–¹æ³•ï¼šainvokeã€astream<a class=anchor href=#213-%e5%bc%82%e6%ad%a5%e6%96%b9%e6%b3%95ainvokeastream>#</a></h4><p>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¼‚æ­¥æ–¹æ³•å¯æ˜¾è‘—æå‡æ€§èƒ½ï¼š</p><p><strong>ainvoke() - å¼‚æ­¥è°ƒç”¨</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># å¼‚æ­¥è°ƒç”¨</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>model</span><span class=o>.</span><span class=n>ainvoke</span><span class=p>(</span><span class=s2>&#34;What is async programming?&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span></span></span></code></pre></div><p><strong>astream() - å¼‚æ­¥æµå¼</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>stream_example</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>for</span> <span class=n>chunk</span> <span class=ow>in</span> <span class=n>model</span><span class=o>.</span><span class=n>astream</span><span class=p>(</span><span class=s2>&#34;Tell me a story&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>chunk</span><span class=o>.</span><span class=n>content</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>stream_example</span><span class=p>())</span></span></span></code></pre></div><p><strong>å¹¶å‘æ€§èƒ½å¯¹æ¯”</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># âŒ åŒæ­¥æ–¹å¼ï¼ˆä¸²è¡Œæ‰§è¡Œï¼Œæ…¢ï¼‰</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sync_batch</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>query</span> <span class=ow>in</span> <span class=n>queries</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>query</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># âœ… å¼‚æ­¥æ–¹å¼ï¼ˆå¹¶å‘æ‰§è¡Œï¼Œå¿«ï¼‰</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>async_batch</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>ainvoke</span><span class=p>(</span><span class=n>query</span><span class=p>)</span> <span class=k>for</span> <span class=n>query</span> <span class=ow>in</span> <span class=n>queries</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>)</span></span></span></code></pre></div><p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>è¯·æ±‚æ•°</th><th>åŒæ­¥è€—æ—¶</th><th>å¼‚æ­¥è€—æ—¶</th><th>æ€§èƒ½æå‡</th></tr></thead><tbody><tr><td>10</td><td>30s</td><td>5s</td><td>6x</td></tr><tr><td>50</td><td>150s</td><td>15s</td><td>10x</td></tr><tr><td>100</td><td>300s</td><td>25s</td><td>12x</td></tr></tbody></table><hr><h4 id=214-runnable-ç±»å‹lambdaparallelbranchfallbacks>2.1.4 Runnable ç±»å‹ï¼šLambdaã€Parallelã€Branchã€Fallbacks<a class=anchor href=#214-runnable-%e7%b1%bb%e5%9e%8blambdaparallelbranchfallbacks>#</a></h4><p><strong>RunnableLambda - è‡ªå®šä¹‰å‡½æ•°åŒ…è£…</strong></p><p>å°†æ™®é€š Python å‡½æ•°åŒ…è£…ä¸º Runnableï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.runnables</span> <span class=kn>import</span> <span class=n>RunnableLambda</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>uppercase</span><span class=p>(</span><span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>text</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åŒ…è£…ä¸º Runnable</span>
</span></span><span class=line><span class=cl><span class=n>runnable_upper</span> <span class=o>=</span> <span class=n>RunnableLambda</span><span class=p>(</span><span class=n>uppercase</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç»Ÿä¸€è°ƒç”¨æ–¹å¼</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>runnable_upper</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;hello&#34;</span><span class=p>)</span>  <span class=c1># &#34;HELLO&#34;</span></span></span></code></pre></div><p><strong>RunnableParallel - å¹¶è¡Œæ‰§è¡Œ</strong></p><p>åŒæ—¶æ‰§è¡Œå¤šä¸ª Runnableï¼Œç»“æœä»¥å­—å…¸å½¢å¼è¿”å›ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.runnables</span> <span class=kn>import</span> <span class=n>RunnableParallel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>parallel</span> <span class=o>=</span> <span class=n>RunnableParallel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>joke</span><span class=o>=</span><span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_template</span><span class=p>(</span><span class=s2>&#34;Tell a joke about </span><span class=si>{topic}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=o>|</span> <span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>poem</span><span class=o>=</span><span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_template</span><span class=p>(</span><span class=s2>&#34;Write a poem about </span><span class=si>{topic}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=o>|</span> <span class=n>model</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¹¶è¡Œæ‰§è¡Œ</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>parallel</span><span class=o>.</span><span class=n>invoke</span><span class=p>({</span><span class=s2>&#34;topic&#34;</span><span class=p>:</span> <span class=s2>&#34;AI&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&#34;joke&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&#34;poem&#34;</span><span class=p>])</span></span></span></code></pre></div><pre class=mermaid>graph TD
    A[Input: topic=&#39;AI&#39;] --&gt; B[RunnableParallel]
    B --&gt; C[Joke Generator]
    B --&gt; D[Poem Generator]
    C --&gt; E[Result Dict]
    D --&gt; E
    E --&gt; F[Output]</pre><p><strong>RunnableBranch - æ¡ä»¶åˆ†æ”¯</strong></p><p>æ ¹æ®æ¡ä»¶é€‰æ‹©ä¸åŒçš„æ‰§è¡Œè·¯å¾„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.runnables</span> <span class=kn>import</span> <span class=n>RunnableBranch</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>branch</span> <span class=o>=</span> <span class=n>RunnableBranch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>,</span> <span class=n>long_text_handler</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>,</span> <span class=n>medium_text_handler</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>short_text_handler</span>  <span class=c1># é»˜è®¤åˆ†æ”¯</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>branch</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;some text&#34;</span><span class=p>)</span></span></span></code></pre></div><pre class=mermaid>graph TD
    A[Input] --&gt; B{len &gt; 100?}
    B -- Yes --&gt; C[Long Text Handler]
    B -- No --&gt; D{len &gt; 10?}
    D -- Yes --&gt; E[Medium Text Handler]
    D -- No --&gt; F[Short Text Handler]</pre><p><strong>with_fallbacks() - é™çº§å¤„ç†</strong></p><p>ä¸» Runnable å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ–¹æ¡ˆï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>primary_model</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fallback_model</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-3.5-turbo&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç›´æ¥ä½¿ç”¨ with_fallbacks æ–¹æ³•ï¼Œæ— éœ€å¯¼å…¥é¢å¤–ç±»</span>
</span></span><span class=line><span class=cl><span class=n>model_with_fallback</span> <span class=o>=</span> <span class=n>primary_model</span><span class=o>.</span><span class=n>with_fallbacks</span><span class=p>([</span><span class=n>fallback_model</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœ GPT-4 å¤±è´¥ï¼Œè‡ªåŠ¨ä½¿ç”¨ GPT-3.5</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>model_with_fallback</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;Hello&#34;</span><span class=p>)</span></span></span></code></pre></div><p><strong>å‚æ•°è¯´æ˜</strong> (åŸºäºå®˜æ–¹APIæ–‡æ¡£éªŒè¯)ï¼š</p><p><strong>å¿…éœ€å‚æ•°</strong>ï¼š</p><ul><li><code>fallbacks</code>: <code>Sequence[Runnable]</code> - å¤‡ç”¨ Runnable åºåˆ—ï¼ŒæŒ‰é¡ºåºå°è¯•</li></ul><p><strong>å¯é€‰å‚æ•°</strong> (ä»…å…³é”®å­—å‚æ•°)ï¼š</p><ul><li><code>exceptions_to_handle</code>: <code>Tuple[Type[BaseException], ...]</code> - éœ€è¦å¤„ç†çš„å¼‚å¸¸ç±»å‹å…ƒç»„ï¼Œé»˜è®¤ä¸º <code>(Exception,)</code></li><li><code>exception_key</code>: <code>Optional[str]</code> - å¯é€‰çš„é”®åï¼Œç”¨äºå°†å¼‚å¸¸ä¿¡æ¯ä¼ é€’ç»™å¤‡ç”¨æ–¹æ¡ˆã€‚å¦‚ä¸º <code>None</code> (é»˜è®¤)ï¼Œå¼‚å¸¸ä¸ä¼ é€’ç»™å¤‡ç”¨æ–¹æ¡ˆ</li></ul><p><strong>å®Œæ•´å‚æ•°ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># âœ… ç¤ºä¾‹1: åªå¯¹ç‰¹å®šå¼‚å¸¸ç±»å‹æ‰§è¡Œé™çº§</span>
</span></span><span class=line><span class=cl><span class=n>model_with_fallback</span> <span class=o>=</span> <span class=n>primary_model</span><span class=o>.</span><span class=n>with_fallbacks</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>fallbacks</span><span class=o>=</span><span class=p>[</span><span class=n>fallback_model</span><span class=p>],</span>  <span class=c1># âœ… å®˜æ–¹æ ‡å‡†å‚æ•°ï¼šfallbacks (å¤æ•°ï¼Œåˆ—è¡¨)</span>
</span></span><span class=line><span class=cl>    <span class=n>exceptions_to_handle</span><span class=o>=</span><span class=p>(</span><span class=ne>TimeoutError</span><span class=p>,</span> <span class=ne>ConnectionError</span><span class=p>),</span>  <span class=c1># âœ… å®˜æ–¹æ ‡å‡†å‚æ•°</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># âœ… ç¤ºä¾‹2: å°†å¼‚å¸¸ä¿¡æ¯ä¼ é€’ç»™å¤‡ç”¨æ–¹æ¡ˆ</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.runnables</span> <span class=kn>import</span> <span class=n>RunnableLambda</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_with_error_context</span><span class=p>(</span><span class=n>inputs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å¤‡ç”¨æ–¹æ¡ˆå¯ä»¥è®¿é—®å¼‚å¸¸ä¿¡æ¯&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;error&#34;</span> <span class=ow>in</span> <span class=n>inputs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Original error: </span><span class=si>{</span><span class=n>inputs</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fallback_model</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>inputs</span><span class=p>[</span><span class=s2>&#34;input&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model_with_error_context</span> <span class=o>=</span> <span class=n>primary_model</span><span class=o>.</span><span class=n>with_fallbacks</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>fallbacks</span><span class=o>=</span><span class=p>[</span><span class=n>RunnableLambda</span><span class=p>(</span><span class=n>handle_with_error_context</span><span class=p>)],</span>  <span class=c1># âœ… ä½¿ç”¨ fallbacks å‚æ•°å</span>
</span></span><span class=line><span class=cl>    <span class=n>exception_key</span><span class=o>=</span><span class=s2>&#34;error&#34;</span>  <span class=c1># âœ… å®˜æ–¹æ ‡å‡†å‚æ•°ï¼šå¼‚å¸¸ä¼šä»¥ &#34;error&#34; é”®ä¼ é€’</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># âš ï¸ é‡è¦ï¼šä½¿ç”¨ exception_key æ—¶ï¼Œä¸» Runnable å’Œæ‰€æœ‰å¤‡ç”¨æ–¹æ¡ˆéƒ½å¿…é¡»æ¥å—å­—å…¸è¾“å…¥</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>model_with_error_context</span><span class=o>.</span><span class=n>invoke</span><span class=p>({</span><span class=s2>&#34;input&#34;</span><span class=p>:</span> <span class=s2>&#34;Hello&#34;</span><span class=p>})</span></span></span></code></pre></div><p><strong>API è§„èŒƒæ€»ç»“</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>with_fallbacks</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>fallbacks</span><span class=p>:</span> <span class=n>Sequence</span><span class=p>[</span><span class=n>Runnable</span><span class=p>[</span><span class=n>Input</span><span class=p>,</span> <span class=n>Output</span><span class=p>]],</span>  <span class=c1># å¿…éœ€</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>exceptions_to_handle</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Type</span><span class=p>[</span><span class=ne>BaseException</span><span class=p>],</span> <span class=o>...</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=ne>Exception</span><span class=p>,),</span>  <span class=c1># å¯é€‰</span>
</span></span><span class=line><span class=cl>    <span class=n>exception_key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># å¯é€‰</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>RunnableWithFallbacksT</span><span class=p>[</span><span class=n>Input</span><span class=p>,</span> <span class=n>Output</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span></span></span></code></pre></div><pre class=mermaid>graph LR
    A[Request] --&gt; B[Primary: GPT-4]
    B -- Success --&gt; C[Return Result]
    B -- Failure --&gt; D[Fallback: GPT-3.5]
    D --&gt; C</pre><hr><h3 id=22-lcel-è¡¨è¾¾å¼è¯­è¨€>2.2 LCEL è¡¨è¾¾å¼è¯­è¨€<a class=anchor href=#22-lcel-%e8%a1%a8%e8%be%be%e5%bc%8f%e8%af%ad%e8%a8%80>#</a></h3><h4 id=221-å£°æ˜å¼ç»„åˆç†å¿µ>2.2.1 å£°æ˜å¼ç»„åˆç†å¿µ<a class=anchor href=#221-%e5%a3%b0%e6%98%8e%e5%bc%8f%e7%bb%84%e5%90%88%e7%90%86%e5%bf%b5>#</a></h4><p>LCELï¼ˆLangChain Expression Languageï¼‰æ˜¯ä¸€ç§<strong>å£°æ˜å¼</strong>è¯­æ³•ï¼Œç”¨äºç»„åˆ Runnable å¯¹è±¡ã€‚</p><p><strong>å‘½ä»¤å¼ vs å£°æ˜å¼</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># âŒ å‘½ä»¤å¼ï¼ˆæ‰‹åŠ¨æ§åˆ¶æµç¨‹ï¼‰</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>imperative_chain</span><span class=p>(</span><span class=nb>input</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>step1_result</span> <span class=o>=</span> <span class=n>prompt</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=nb>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>step2_result</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>step1_result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>step3_result</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>step2_result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>step3_result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># âœ… å£°æ˜å¼ï¼ˆLCEL ç®¡é“ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=n>prompt</span> <span class=o>|</span> <span class=n>model</span> <span class=o>|</span> <span class=n>parser</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=nb>input</span><span class=p>)</span></span></span></code></pre></div><p><strong>LCEL çš„æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p><pre class=mermaid>mindmap
  root((LCEL))
    å£°æ˜å¼
      ä»£ç ç®€æ´
      æ„å›¾æ¸…æ™°
    å¯ç»„åˆ
      ç®¡é“è¿æ¥
      åµŒå¥—ç»„åˆ
    è‡ªåŠ¨ä¼˜åŒ–
      å¹¶è¡Œæ‰§è¡Œ
      æµå¼ä¼ è¾“
    å¯è¿½è¸ª
      LangSmith é›†æˆ
      Debug å‹å¥½</pre><hr><h4 id=222-ç®¡é“æ“ä½œç¬¦--ä¸å¹¶è¡Œ->2.2.2 ç®¡é“æ“ä½œç¬¦ <code>|</code> ä¸å¹¶è¡Œ <code>{}</code><a class=anchor href=#222-%e7%ae%a1%e9%81%93%e6%93%8d%e4%bd%9c%e7%ac%a6--%e4%b8%8e%e5%b9%b6%e8%a1%8c->#</a></h4><p><strong>ç®¡é“æ“ä½œç¬¦ <code>|</code> - é¡ºåºæ‰§è¡Œ</strong></p><p>å°†å¤šä¸ª Runnable ä¸²è”æˆç®¡é“ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.output_parsers</span> <span class=kn>import</span> <span class=n>StrOutputParser</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç®¡é“ç»„åˆ</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_template</span><span class=p>(</span><span class=s2>&#34;Tell me about </span><span class=si>{topic}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>ChatOpenAI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>StrOutputParser</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è‡ªåŠ¨æŒ‰é¡ºåºæ‰§è¡Œ</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>({</span><span class=s2>&#34;topic&#34;</span><span class=p>:</span> <span class=s2>&#34;LangChain&#34;</span><span class=p>})</span></span></span></code></pre></div><p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p><pre class=mermaid>graph LR
    A[Input] --&gt; B[Prompt Template]
    B --&gt; C[ChatOpenAI]
    C --&gt; D[StrOutputParser]
    D --&gt; E[Output]

    style B fill:#FFF9C4
    style C fill:#E3F2FD
    style D fill:#DCEDC8</pre><p><strong>å¹¶è¡Œå­—å…¸ <code>{}</code> - å¹¶è¡Œæ‰§è¡Œ</strong></p><p>ä½¿ç”¨å­—å…¸è¯­æ³•å®ç°å¹¶è¡Œæ‰§è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.runnables</span> <span class=kn>import</span> <span class=n>RunnablePassthrough</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;context&#34;</span><span class=p>:</span> <span class=n>retriever</span> <span class=o>|</span> <span class=n>format_docs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;question&#34;</span><span class=p>:</span> <span class=n>RunnablePassthrough</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=o>|</span> <span class=n>prompt</span> <span class=o>|</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># context å’Œ question å¹¶è¡Œå¤„ç†</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;What is LangChain?&#34;</span><span class=p>)</span></span></span></code></pre></div><p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p><pre class=mermaid>graph TD
    A[Input] --&gt; B[RunnableParallel]
    B --&gt; C[context: retriever]
    B --&gt; D[question: passthrough]
    C --&gt; E[Merge Results]
    D --&gt; E
    E --&gt; F[Prompt]
    F --&gt; G[Model]</pre><p><strong>assign() - çŠ¶æ€æ›´æ–°å¿«æ·æ–¹å¼</strong></p><p><code>RunnablePassthrough.assign()</code> æ˜¯ LCEL ä¸­æœ€å¸¸ç”¨çš„æ“ä½œä¹‹ä¸€ï¼Œç”¨äºåœ¨é“¾ä¸­æ·»åŠ æˆ–æ›´æ–°å­—æ®µï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.runnables</span> <span class=kn>import</span> <span class=n>RunnablePassthrough</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_chroma</span> <span class=kn>import</span> <span class=n>Chroma</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>OpenAIEmbeddings</span><span class=p>,</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.output_parsers</span> <span class=kn>import</span> <span class=n>StrOutputParser</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºå‘é‡æ£€ç´¢å™¨</span>
</span></span><span class=line><span class=cl><span class=n>vectorstore</span> <span class=o>=</span> <span class=n>Chroma</span><span class=o>.</span><span class=n>from_texts</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=s2>&#34;LangChainæ˜¯ä¸€ä¸ªAIåº”ç”¨æ¡†æ¶&#34;</span><span class=p>,</span> <span class=s2>&#34;å®ƒæ”¯æŒRAGå’ŒAgent&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>embedding</span><span class=o>=</span><span class=n>OpenAIEmbeddings</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>retriever</span> <span class=o>=</span> <span class=n>vectorstore</span><span class=o>.</span><span class=n>as_retriever</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ assign() æ·»åŠ æ£€ç´¢ä¸Šä¸‹æ–‡</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>RunnablePassthrough</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>=</span><span class=n>retriever</span>  <span class=c1># æ·»åŠ  context å­—æ®µ</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_template</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜:</span><span class=se>\n</span><span class=si>{context}</span><span class=se>\n\n</span><span class=s2>é—®é¢˜: </span><span class=si>{question}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>ChatOpenAI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>StrOutputParser</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¾“å…¥åªéœ€è¦ questionï¼Œcontext ä¼šè‡ªåŠ¨æ·»åŠ </span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>({</span><span class=s2>&#34;question&#34;</span><span class=p>:</span> <span class=s2>&#34;ä»€ä¹ˆæ˜¯LangChain?&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=c1># å†…éƒ¨æµç¨‹: {&#34;question&#34;: &#34;...&#34;} -&gt; {&#34;question&#34;: &#34;...&#34;, &#34;context&#34;: [...]}</span></span></span></code></pre></div><p><strong>assign() çš„ä¼˜åŠ¿</strong>ï¼š</p><ol><li><strong>ä¿ç•™åŸå§‹è¾“å…¥</strong>ï¼šä¸è¦†ç›–å·²æœ‰å­—æ®µ</li><li><strong>ç®€åŒ–ä»£ç </strong>ï¼šé¿å…æ‰‹åŠ¨æ„é€ å­—å…¸</li><li><strong>é“¾å¼ç»„åˆ</strong>ï¼šå¯ä»¥å¤šæ¬¡è°ƒç”¨</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># å¤šæ¬¡ assign å åŠ å­—æ®µ</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>RunnablePassthrough</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=o>=</span><span class=n>retriever</span>  <span class=c1># æ·»åŠ æ£€ç´¢ç»“æœ</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>assign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>context_count</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=s2>&#34;context&#34;</span><span class=p>])</span>  <span class=c1># æ·»åŠ ç»Ÿè®¡ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>assign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=s2>&#34;2025-11-17&#34;</span>  <span class=c1># æ·»åŠ æ—¶é—´æˆ³</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>prompt</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>model</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¾“å…¥: {&#34;question&#34;: &#34;...&#34;}</span>
</span></span><span class=line><span class=cl><span class=c1># ç¬¬ä¸€æ­¥å: {&#34;question&#34;: &#34;...&#34;, &#34;context&#34;: [...]}</span>
</span></span><span class=line><span class=cl><span class=c1># ç¬¬äºŒæ­¥å: {&#34;question&#34;: &#34;...&#34;, &#34;context&#34;: [...], &#34;context_count&#34;: 3}</span>
</span></span><span class=line><span class=cl><span class=c1># ç¬¬ä¸‰æ­¥å: {&#34;question&#34;: &#34;...&#34;, &#34;context&#34;: [...], &#34;context_count&#34;: 3, &#34;timestamp&#34;: &#34;...&#34;}</span></span></span></code></pre></div><p><strong>å¸¸è§ä½¿ç”¨åœºæ™¯</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># åœºæ™¯1: RAG æ·»åŠ æ£€ç´¢ä¸Šä¸‹æ–‡</span>
</span></span><span class=line><span class=cl><span class=n>rag_chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>RunnablePassthrough</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=n>context</span><span class=o>=</span><span class=n>retriever</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>rag_prompt</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>model</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åœºæ™¯2: æ·»åŠ å¤šä¸ªæ•°æ®æº</span>
</span></span><span class=line><span class=cl><span class=n>multi_source_chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>RunnablePassthrough</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>docs</span><span class=o>=</span><span class=n>doc_retriever</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>history</span><span class=o>=</span><span class=n>history_retriever</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>metadata</span><span class=o>=</span><span class=n>metadata_fetcher</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>prompt</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>model</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åœºæ™¯3: æ•°æ®è½¬æ¢</span>
</span></span><span class=line><span class=cl><span class=n>transform_chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>RunnablePassthrough</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>upper_text</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=s2>&#34;text&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>upper</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>word_count</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=s2>&#34;text&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>processor</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div><hr><h4 id=223-ç»„åˆæ¨¡å¼é¡ºåºå¹¶è¡Œæ¡ä»¶å¾ªç¯>2.2.3 ç»„åˆæ¨¡å¼ï¼šé¡ºåºã€å¹¶è¡Œã€æ¡ä»¶ã€å¾ªç¯<a class=anchor href=#223-%e7%bb%84%e5%90%88%e6%a8%a1%e5%bc%8f%e9%a1%ba%e5%ba%8f%e5%b9%b6%e8%a1%8c%e6%9d%a1%e4%bb%b6%e5%be%aa%e7%8e%af>#</a></h4><p><strong>é¡ºåºé“¾æ¥</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ç®€å•é¡ºåº</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=n>step1</span> <span class=o>|</span> <span class=n>step2</span> <span class=o>|</span> <span class=n>step3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¤æ‚é¡ºåº</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;input&#34;</span><span class=p>:</span> <span class=n>RunnablePassthrough</span><span class=p>()}</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>prompt</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=p>{</span><span class=s2>&#34;output&#34;</span><span class=p>:</span> <span class=n>parser</span><span class=p>,</span> <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=n>RunnablePassthrough</span><span class=p>()}</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div><p><strong>å¹¶è¡Œæ‰§è¡Œ</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># å¹¶è¡Œè·å–å¤šä¸ªä¿¡æ¯</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=n>RunnableParallel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>summary</span><span class=o>=</span><span class=n>summarize_chain</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>keywords</span><span class=o>=</span><span class=n>extract_keywords_chain</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>sentiment</span><span class=o>=</span><span class=n>sentiment_chain</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div><p><strong>æ¡ä»¶åˆ†æ”¯</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.runnables</span> <span class=kn>import</span> <span class=n>RunnableBranch</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ ¹æ®è¾“å…¥é•¿åº¦é€‰æ‹©ä¸åŒå¤„ç†</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=n>RunnableBranch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=s2>&#34;text&#34;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>1000</span><span class=p>,</span> <span class=n>long_text_chain</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=s2>&#34;text&#34;</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>,</span> <span class=n>medium_text_chain</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>short_text_chain</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div><p><strong>å¾ªç¯è¿­ä»£</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ä½¿ç”¨ RunnableLambda å®ç°å¾ªç¯</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>iterative_refine</span><span class=p>(</span><span class=nb>input</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nb>input</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>refine_chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=n>RunnableLambda</span><span class=p>(</span><span class=n>iterative_refine</span><span class=p>)</span></span></span></code></pre></div><hr><h3 id=23-é«˜çº§ç‰¹æ€§>2.3 é«˜çº§ç‰¹æ€§<a class=anchor href=#23-%e9%ab%98%e7%ba%a7%e7%89%b9%e6%80%a7>#</a></h3><h4 id=231-fallback-é™çº§ä¸-retry-é‡è¯•>2.3.1 Fallback é™çº§ä¸ Retry é‡è¯•<a class=anchor href=#231-fallback-%e9%99%8d%e7%ba%a7%e4%b8%8e-retry-%e9%87%8d%e8%af%95>#</a></h4><p><strong>Fallback - è‡ªåŠ¨é™çº§</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># å¤šçº§é™çº§</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>primary_model</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>with_fallbacks</span><span class=p>(</span><span class=n>fallbacks</span><span class=o>=</span><span class=p>[</span><span class=n>backup_model_1</span><span class=p>,</span> <span class=n>backup_model_2</span><span class=p>])</span>  <span class=c1># âœ… ä½¿ç”¨ fallbacks å‚æ•°å</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åªå¯¹ç‰¹å®šå¼‚å¸¸æ‰§è¡Œé™çº§</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>primary_model</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>with_fallbacks</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>fallbacks</span><span class=o>=</span><span class=p>[</span><span class=n>backup_model_1</span><span class=p>,</span> <span class=n>backup_model_2</span><span class=p>],</span>  <span class=c1># âœ… ä½¿ç”¨ fallbacks å‚æ•°å</span>
</span></span><span class=line><span class=cl>        <span class=n>exceptions_to_handle</span><span class=o>=</span><span class=p>(</span><span class=ne>TimeoutError</span><span class=p>,</span> <span class=ne>ConnectionError</span><span class=p>)</span>  <span class=c1># âœ… å®˜æ–¹æ ‡å‡†å‚æ•°</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div><p><strong>é™çº§æµç¨‹</strong>ï¼š</p><pre class=mermaid>graph TD
    A[Request] --&gt; B[Primary Model]
    B -- Success --&gt; Z[Return]
    B -- Failure --&gt; C[Backup Model 1]
    C -- Success --&gt; Z
    C -- Failure --&gt; D[Backup Model 2]
    D --&gt; Z</pre><p><strong>Retry - è‡ªåŠ¨é‡è¯•</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ç›´æ¥ä½¿ç”¨ with_retry æ–¹æ³•ï¼Œæ— éœ€å•ç‹¬å¯¼å…¥</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>prompt</span> <span class=o>|</span> <span class=n>model</span> <span class=o>|</span> <span class=n>parser</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>with_retry</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>stop_after_attempt</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>  <span class=c1># æœ€å¤§é‡è¯•æ¬¡æ•°</span>
</span></span><span class=line><span class=cl>    <span class=n>wait_exponential_jitter</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># æŒ‡æ•°é€€é¿ + éšæœºæŠ–åŠ¨</span>
</span></span><span class=line><span class=cl>    <span class=n>retry_if_exception_type</span><span class=o>=</span><span class=p>(</span><span class=ne>Exception</span><span class=p>,)</span>  <span class=c1># æŒ‡å®šéœ€è¦é‡è¯•çš„å¼‚å¸¸ç±»å‹</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div><p><strong>å‚æ•°è¯´æ˜</strong>ï¼ˆåŸºäºå®˜æ–¹APIæ–‡æ¡£éªŒè¯ï¼‰ï¼š</p><ul><li><code>stop_after_attempt</code>ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 3</li><li><code>wait_exponential_jitter</code>ï¼šæ˜¯å¦ä½¿ç”¨æŒ‡æ•°é€€é¿ + éšæœºæŠ–åŠ¨ï¼Œé»˜è®¤ä¸º True</li><li><code>retry_if_exception_type</code>ï¼šéœ€è¦é‡è¯•çš„å¼‚å¸¸ç±»å‹å…ƒç»„ï¼Œé»˜è®¤ä¸º <code>(Exception,)</code></li></ul><p><strong>é‡è¯•ç­–ç•¥ç¤ºä¾‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åªå¯¹ç‰¹å®šå¼‚å¸¸é‡è¯•</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span><span class=n>prompt</span> <span class=o>|</span> <span class=n>model</span> <span class=o>|</span> <span class=n>parser</span><span class=p>)</span><span class=o>.</span><span class=n>with_retry</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>retry_if_exception_type</span><span class=o>=</span><span class=p>(</span><span class=ne>TimeoutError</span><span class=p>,</span> <span class=ne>ConnectionError</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>stop_after_attempt</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>wait_exponential_jitter</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¦ç”¨æŒ‡æ•°é€€é¿ï¼ˆç«‹å³é‡è¯•ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span><span class=n>prompt</span> <span class=o>|</span> <span class=n>model</span> <span class=o>|</span> <span class=n>parser</span><span class=p>)</span><span class=o>.</span><span class=n>with_retry</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>stop_after_attempt</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>wait_exponential_jitter</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># ç¦ç”¨æŒ‡æ•°é€€é¿ï¼Œç«‹å³é‡è¯•</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div><p><strong>é‡è¯•è¡Œä¸º</strong>ï¼š</p><ul><li>æŒ‡æ•°é€€é¿ï¼š1s â†’ 2s â†’ 4s â†’ 8s</li><li>æœ€å¤§é‡è¯•æ¬¡æ•°ï¼šå¯è‡ªå®šä¹‰ï¼ˆé»˜è®¤3æ¬¡ï¼‰</li><li>é‡è¯•æ¡ä»¶ï¼šå¯æŒ‡å®šå¼‚å¸¸ç±»å‹ï¼ˆé»˜è®¤æ‰€æœ‰ Exceptionï¼‰</li></ul><hr><h4 id=232-timeout-è¶…æ—¶æ§åˆ¶>2.3.2 Timeout è¶…æ—¶æ§åˆ¶<a class=anchor href=#232-timeout-%e8%b6%85%e6%97%b6%e6%8e%a7%e5%88%b6>#</a></h4><p><strong>é‡è¦</strong>: <code>RunnableConfig</code> ä¸æ”¯æŒ <code>timeout</code> å‚æ•°ã€‚è¶…æ—¶æ§åˆ¶åº”åœ¨æ¨¡å‹å±‚é¢é…ç½®ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># âœ… æ­£ç¡®ï¼šåœ¨æ¨¡å‹æ„é€ æ—¶è®¾ç½®timeout</span>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>  <span class=c1># 30ç§’è¶…æ—¶</span>
</span></span><span class=line><span class=cl>    <span class=n>max_retries</span><span class=o>=</span><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=n>prompt</span> <span class=o>|</span> <span class=n>model</span> <span class=o>|</span> <span class=n>parser</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=nb>input</span><span class=p>)</span></span></span></code></pre></div><p><strong>è¶…æ—¶ + é™çº§ç»„åˆç­–ç•¥</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸»æ¨¡å‹ï¼šä¸¥æ ¼è¶…æ—¶</span>
</span></span><span class=line><span class=cl><span class=n>slow_model</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4&#34;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é™çº§æ¨¡å‹ï¼šå¿«é€Ÿå“åº”</span>
</span></span><span class=line><span class=cl><span class=n>fast_model</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-3.5-turbo&#34;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç»„åˆè¶…æ—¶ + é™çº§</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=p>(</span><span class=n>prompt</span> <span class=o>|</span> <span class=n>slow_model</span> <span class=o>|</span> <span class=n>parser</span><span class=p>)</span><span class=o>.</span><span class=n>with_fallbacks</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=n>prompt</span> <span class=o>|</span> <span class=n>fast_model</span> <span class=o>|</span> <span class=n>parser</span>
</span></span><span class=line><span class=cl><span class=p>])</span></span></span></code></pre></div><p><strong>ä½¿ç”¨ RunnableConfig é…ç½®å…¶ä»–å‚æ•°</strong>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.runnables</span> <span class=kn>import</span> <span class=n>RunnableConfig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RunnableConfigæ”¯æŒçš„å‚æ•°</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nb>input</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>config</span><span class=o>=</span><span class=n>RunnableConfig</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>max_concurrency</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>      <span class=c1># æœ€å¤§å¹¶å‘æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;production&#34;</span><span class=p>],</span>     <span class=c1># æ ‡ç­¾ï¼ˆç”¨äºç›‘æ§ï¼‰</span>
</span></span><span class=line><span class=cl>        <span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;user&#34;</span><span class=p>:</span> <span class=s2>&#34;alice&#34;</span><span class=p>}</span>  <span class=c1># å…ƒæ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div><hr><h4 id=233-ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–>2.3.3 ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–<a class=anchor href=#233-%e7%bc%93%e5%ad%98%e4%b8%8e%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96>#</a></h4><blockquote class=book-hint><p>ğŸ’¡ <strong>æç¤º</strong>: æœ¬èŠ‚ä»‹ç» Runnable Protocol çš„åŸºç¡€æ€§èƒ½APIã€‚ç”Ÿäº§ç¯å¢ƒçš„æ·±åº¦æ€§èƒ½è°ƒä¼˜ã€æˆæœ¬æ§åˆ¶ã€ç¼“å­˜æ¶æ„ç­‰å†…å®¹ï¼Œè¯¦è§ <strong>ç¬¬å…«ç¯‡ã€Šç”Ÿäº§å®è·µã€‹ç¬¬21ç« </strong>ã€‚</p></blockquote><p><strong>LLM ç¼“å­˜</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.caches</span> <span class=kn>import</span> <span class=n>InMemoryCache</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.globals</span> <span class=kn>import</span> <span class=n>set_llm_cache</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¯ç”¨ç¼“å­˜</span>
</span></span><span class=line><span class=cl><span class=n>set_llm_cache</span><span class=p>(</span><span class=n>InMemoryCache</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç›¸åŒè¯·æ±‚ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ</span>
</span></span><span class=line><span class=cl><span class=n>model</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;What is AI?&#34;</span><span class=p>)</span>  <span class=c1># è°ƒç”¨ LLM</span>
</span></span><span class=line><span class=cl><span class=n>model</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=s2>&#34;What is AI?&#34;</span><span class=p>)</span>  <span class=c1># è¿”å›ç¼“å­˜ï¼ˆä¸è°ƒç”¨ LLMï¼‰</span></span></span></code></pre></div><p><strong>æ‰¹å¤„ç†ä¼˜åŒ–</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># æ‰¹å¤„ç†ä¼˜åŒ–ï¼ˆä½¿ç”¨max_concurrencyæ§åˆ¶å¹¶å‘ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=n>prompt</span> <span class=o>|</span> <span class=n>model</span><span class=o>.</span><span class=n>with_config</span><span class=p>({</span><span class=s2>&#34;max_concurrency&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å†…éƒ¨è‡ªåŠ¨åˆå¹¶è¯·æ±‚</span>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>batch</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span></span></span></code></pre></div><p><strong>æµå¼ä¼˜åŒ–</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># æµå¼ä¼ è¾“å‡å°‘å»¶è¿Ÿ</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>chunk</span> <span class=ow>in</span> <span class=n>chain</span><span class=o>.</span><span class=n>stream</span><span class=p>(</span><span class=nb>input</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>chunk</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>)</span></span></span></code></pre></div><p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>æ™®é€šè°ƒç”¨</th><th>ä¼˜åŒ–å</th><th>æ€§èƒ½æå‡</th></tr></thead><tbody><tr><td>ç¼“å­˜</td><td>2s</td><td>50ms</td><td>40x</td></tr><tr><td>æ‰¹å¤„ç†</td><td>10s</td><td>2s</td><td>5x</td></tr><tr><td>æµå¼</td><td>TTFT 2s</td><td>TTFT 200ms</td><td>10x</td></tr></tbody></table><hr><h3 id=æœ¬ç« å°ç»“-1>æœ¬ç« å°ç»“<a class=anchor href=#%e6%9c%ac%e7%ab%a0%e5%b0%8f%e7%bb%93-1>#</a></h3><p><strong>Runnable Protocol æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p><ul><li>âœ… ç»Ÿä¸€æ¥å£ï¼šinvokeã€streamã€batchã€ainvokeã€astream</li><li>âœ… å¯ç»„åˆæ€§ï¼šLambdaã€Parallelã€Branchã€Fallbacks</li><li>âœ… å¯è¿½è¸ªæ€§ï¼šè‡ªåŠ¨é›†æˆ LangSmith</li><li>âœ… æ€§èƒ½ä¼˜åŒ–ï¼šå¼‚æ­¥ã€æ‰¹å¤„ç†ã€ç¼“å­˜</li></ul><p><strong>LCEL æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p><ul><li>âœ… å£°æ˜å¼ç»„åˆï¼š<code>|</code> ç®¡é“ã€<code>{}</code> å¹¶è¡Œ</li><li>âœ… è‡ªåŠ¨ä¼˜åŒ–ï¼šå¹¶è¡Œæ‰§è¡Œã€æµå¼ä¼ è¾“</li><li>âœ… é«˜çº§ç‰¹æ€§ï¼šFallbackã€Retryã€Timeoutã€Cache</li></ul><p><strong>è®¾è®¡å“²å­¦</strong>ï¼š</p><blockquote class=book-hint><p>ä¸€åˆ‡çš† Runnableï¼Œæ‰€æœ‰ç»„ä»¶ç»Ÿä¸€æ¥å£ï¼Œå£°æ˜å¼ç»„åˆï¼Œè‡ªåŠ¨ä¼˜åŒ–æ‰§è¡Œã€‚</p></blockquote><hr><h3 id=æ€è€ƒä¸ç»ƒä¹ -1>æ€è€ƒä¸ç»ƒä¹ <a class=anchor href=#%e6%80%9d%e8%80%83%e4%b8%8e%e7%bb%83%e4%b9%a0-1>#</a></h3><ol><li><p><strong>ç»ƒä¹  1ï¼šåŸºç¡€ç®¡é“</strong>
æ„å»ºä¸€ä¸ª LCEL ç®¡é“ï¼šPrompt â†’ Model â†’ Parserï¼Œå®ç°ä¸€ä¸ªç®€å•çš„é—®ç­”ç³»ç»Ÿã€‚</p></li><li><p><strong>ç»ƒä¹  2ï¼šå¹¶è¡Œå¤„ç†</strong>
ä½¿ç”¨ RunnableParallel åŒæ—¶ç”Ÿæˆä¸€ä¸ªç¬‘è¯ã€ä¸€é¦–è¯—å’Œä¸€ä¸ªæ•…äº‹ï¼Œè¾“å…¥ä¸»é¢˜ä¸º"AI"ã€‚</p></li><li><p><strong>ç»ƒä¹  3ï¼šé”™è¯¯å¤„ç†</strong>
å®ç°ä¸€ä¸ªå¸¦æœ‰ Fallback å’Œ Retry çš„ chainï¼Œä¸»æ¨¡å‹å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ¨¡å‹ã€‚</p></li><li><p><strong>ç»ƒä¹  4ï¼šæ€§èƒ½ä¼˜åŒ–</strong>
å¯¹æ¯”åŒæ­¥æ‰¹å¤„ç†å’Œå¼‚æ­¥æ‰¹å¤„ç†çš„æ€§èƒ½å·®å¼‚ï¼ˆ10ä¸ªè¯·æ±‚ï¼‰ã€‚</p></li><li><p><strong>æ€è€ƒé¢˜ï¼š</strong></p><ul><li>ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥ä½¿ç”¨ stream è€Œä¸æ˜¯ invokeï¼Ÿ</li><li>RunnableBranch å’Œç®€å•çš„ if-else æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>å¦‚ä½•åœ¨ LCEL ä¸­å®ç°å¾ªç¯é€»è¾‘ï¼Ÿ</li></ul></li></ol></article><div style="margin-top:2rem;border-top:1px solid #e5e7eb;padding-top:1rem;font-size:.85rem;color:#6b7280;text-align:center">[ç»Ÿè®¡ç»„ä»¶ä»…åœ¨ç”Ÿäº§ç¯å¢ƒæ˜¾ç¤º]</div><div class=giscus style=margin-top:2rem></div><script src=https://giscus.app/client.js data-repo=LordFoxFairy/LordFoxFairy.github.io data-repo-id=R_kgDOQ-JRGA data-category=Announcements data-category-id=DIC_kwDOQ-JRGM4C1PDC data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span></span><span><a href=/notebooks/langchain%E7%AC%94%E8%AE%B0/%E7%AC%AC%E4%BA%8C%E7%AF%87-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E5%AE%9E%E6%88%98/ class="flex align-center"><span>ç¬¬äºŒç¯‡ å¿«é€Ÿä¸Šæ‰‹å®æˆ˜</span>
<img src=/icons/forward.svg class=book-icon alt=Forward></a></span></div><div class=book-comments></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#-å‰ç½®å‡†å¤‡>ğŸ“‹ å‰ç½®å‡†å¤‡</a><ul><li><a href=#ç¯å¢ƒé…ç½®>ç¯å¢ƒé…ç½®</a><ul><li><a href=#1-python-ç‰ˆæœ¬>1. Python ç‰ˆæœ¬</a></li><li><a href=#2-å®‰è£…ä¾èµ–>2. å®‰è£…ä¾èµ–</a></li><li><a href=#3-ç¯å¢ƒå˜é‡é…ç½®>3. ç¯å¢ƒå˜é‡é…ç½®</a></li><li><a href=#4-ä¾èµ–ç‰ˆæœ¬æ¸…å•>4. ä¾èµ–ç‰ˆæœ¬æ¸…å•</a></li></ul></li><li><a href=#å‰ç½®çŸ¥è¯†>å‰ç½®çŸ¥è¯†</a></li></ul></li><li><a href=#ç¬¬1ç« langchain-ç”Ÿæ€å…¨æ™¯>ç¬¬1ç« ï¼šLangChain ç”Ÿæ€å…¨æ™¯</a><ul><li><a href=#11-æ¶æ„å±‚æ¬¡å…³ç³»>1.1 æ¶æ„å±‚æ¬¡å…³ç³»</a><ul><li><a href=#111-langchain-ä¸-langgraph-çš„å…³ç³»>1.1.1 LangChain ä¸ LangGraph çš„å…³ç³»</a></li><li><a href=#112-å¦‚ä½•æ„å»º-agent>1.1.2 å¦‚ä½•æ„å»º Agent</a></li><li><a href=#113-lcel-çš„å®šä½ä¸ä½œç”¨>1.1.3 LCEL çš„å®šä½ä¸ä½œç”¨</a></li><li><a href=#114-langsmith-çš„ç›‘æ§èŒè´£>1.1.4 LangSmith çš„ç›‘æ§èŒè´£</a></li></ul></li><li><a href=#12-æ ¸å¿ƒè®¾è®¡ç†å¿µ>1.2 æ ¸å¿ƒè®¾è®¡ç†å¿µ</a><ul><li><a href=#121-provider-agnostic-è®¾è®¡>1.2.1 Provider-Agnostic è®¾è®¡</a></li><li><a href=#122-runnable-protocol-ç»Ÿä¸€æŠ½è±¡>1.2.2 Runnable Protocol ç»Ÿä¸€æŠ½è±¡</a></li><li><a href=#123-middleware-driven-æ¶æ„>1.2.3 Middleware-Driven æ¶æ„</a></li><li><a href=#124-production-first-ç†å¿µ>1.2.4 Production-First ç†å¿µ</a></li></ul></li><li><a href=#13-æŠ€æœ¯é€‰å‹å†³ç­–æ ‘>1.3 æŠ€æœ¯é€‰å‹å†³ç­–æ ‘</a></li><li><a href=#131-ä½•æ—¶ä½¿ç”¨-create_agent>1.3.1 ä½•æ—¶ä½¿ç”¨ create_agent</a></li><li><a href=#132-ä½•æ—¶æ·±å…¥-langgraph>1.3.2 ä½•æ—¶æ·±å…¥ LangGraph</a></li><li><a href=#133-ä½•æ—¶ä½¿ç”¨-deep-agents>1.3.3 ä½•æ—¶ä½¿ç”¨ Deep Agents</a></li><li><a href=#134-ä½•æ—¶éœ€è¦-middleware>1.3.4 ä½•æ—¶éœ€è¦ Middleware</a></li><li><a href=#135-å…¸å‹åº”ç”¨åœºæ™¯åˆ†æ>1.3.5 å…¸å‹åº”ç”¨åœºæ™¯åˆ†æ</a></li><li><a href=#æœ¬ç« å°ç»“>æœ¬ç« å°ç»“</a></li><li><a href=#æ€è€ƒä¸ç»ƒä¹ >æ€è€ƒä¸ç»ƒä¹ </a></li></ul></li><li><a href=#ç¬¬2ç« æ ¸å¿ƒæŠ½è±¡runnable-ä¸-lcel>ç¬¬2ç« ï¼šæ ¸å¿ƒæŠ½è±¡ï¼šRunnable ä¸ LCEL</a><ul><li><a href=#21-runnable-protocol>2.1 Runnable Protocol</a><ul><li><a href=#211-ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€æŠ½è±¡>2.1.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€æŠ½è±¡</a></li><li><a href=#212-æ ¸å¿ƒæ–¹æ³•invokestreambatch>2.1.2 æ ¸å¿ƒæ–¹æ³•ï¼šinvokeã€streamã€batch</a></li><li><a href=#213-å¼‚æ­¥æ–¹æ³•ainvokeastream>2.1.3 å¼‚æ­¥æ–¹æ³•ï¼šainvokeã€astream</a></li><li><a href=#214-runnable-ç±»å‹lambdaparallelbranchfallbacks>2.1.4 Runnable ç±»å‹ï¼šLambdaã€Parallelã€Branchã€Fallbacks</a></li></ul></li><li><a href=#22-lcel-è¡¨è¾¾å¼è¯­è¨€>2.2 LCEL è¡¨è¾¾å¼è¯­è¨€</a><ul><li><a href=#221-å£°æ˜å¼ç»„åˆç†å¿µ>2.2.1 å£°æ˜å¼ç»„åˆç†å¿µ</a></li><li><a href=#222-ç®¡é“æ“ä½œç¬¦--ä¸å¹¶è¡Œ->2.2.2 ç®¡é“æ“ä½œç¬¦ <code>|</code> ä¸å¹¶è¡Œ <code>{}</code></a></li><li><a href=#223-ç»„åˆæ¨¡å¼é¡ºåºå¹¶è¡Œæ¡ä»¶å¾ªç¯>2.2.3 ç»„åˆæ¨¡å¼ï¼šé¡ºåºã€å¹¶è¡Œã€æ¡ä»¶ã€å¾ªç¯</a></li></ul></li><li><a href=#23-é«˜çº§ç‰¹æ€§>2.3 é«˜çº§ç‰¹æ€§</a><ul><li><a href=#231-fallback-é™çº§ä¸-retry-é‡è¯•>2.3.1 Fallback é™çº§ä¸ Retry é‡è¯•</a></li><li><a href=#232-timeout-è¶…æ—¶æ§åˆ¶>2.3.2 Timeout è¶…æ—¶æ§åˆ¶</a></li><li><a href=#233-ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–>2.3.3 ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–</a></li></ul></li><li><a href=#æœ¬ç« å°ç»“-1>æœ¬ç« å°ç»“</a></li><li><a href=#æ€è€ƒä¸ç»ƒä¹ -1>æ€è€ƒä¸ç»ƒä¹ </a></li></ul></li></ul></nav></div></aside></main></body></html>